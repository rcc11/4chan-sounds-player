// ==UserScript==
// @name         4chan sounds player
// @version      3.0.0-32b5b39
// @namespace    rccom
// @description  A player designed for 4chan sounds threads.
// @author       RCC
// @match        *://boards.4chan.org/*
// @match        *://boards.4channel.org/*
// @match        *://desuarchive.org/*
// @match        *://arch.b4k.co/*
// @match        *://archived.moe/*
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        GM.xmlHttpRequest
// @grant        GM_addValueChangeListener
// @connect      4chan.org
// @connect      4channel.org
// @connect      a.4cdn.org
// @connect      desu-usergeneratedcontent.xyz
// @connect      arch-img.b4k.co
// @connect      4cdn.org
// @connect      a.pomf.cat
// @connect      pomf.cat
// @connect      files.catbox.moe
// @connect      catbox.moe
// @connect      share.dmca.gripe
// @connect      z.zz.ht
// @connect      zz.ht
// @connect      too.lewd.se
// @connect      lewd.se
// @connect      *
// @run-at       document-start
// @updateURL    https://raw.githubusercontent.com/rcc11/4chan-sounds-player/master/dist/4chan-sounds-player.meta.js
// @downloadURL  https://raw.githubusercontent.com/rcc11/4chan-sounds-player/master/dist/4chan-sounds-player.js
// ==/UserScript==


!function(e){var t={};function n(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){e.exports=[...n(6),...n(7),...n(8),...n(9),...n(10),{property:"shuffle",default:!1},{property:"repeat",default:"all"},{property:"viewStyle",default:"playlist"},{property:"hoverImages",default:!1},{property:"showPlaylistSearch",deafult:!0}]},function(e,t){const n=/^(https?:)?\/\//,a=/(.*?)[[({](?:audio|sound)[ =:|$](.*?)[\])}]/g;let s=0;function r(e,t){try{if(e.classList.contains("style-fetcher"))return;if("qp"===e.parentElement.parentElement.id||e.parentElement.classList.contains("noFile"))return;let n=e.querySelector(`.${ns}-play-link`);if(n){const e=n.getAttribute("data-id");return void(n.onclick=()=>Player.play(Player.sounds.find(t=>t.id===e)))}let a,s=null;if(a=is4chan?{".fileText .file-info .fnfull":"textContent",".fileText .file-info > a":"textContent",".fileText > a":"title",".fileText":"textContent"}:{".post_file_filename":"title"},Object.keys(a).some((function(t){const n=e.querySelector(t);return n&&(s=n[a[t]])})),!s)return;const r=e.id.slice(is4chan?1:0),l=e.querySelector(is4chan?".fileThumb":".thread_image_link"),i=l&&l.href,d=l&&l.querySelector("img"),c=d&&d.src,u=d&&d.getAttribute("data-md5"),y=o(s,i,r,c,u);if(!y.length)return;const p=y[0].id,h=is4chan?"play":"Play",f=ns+"-play-link"+(is4chan?"":" btnr");let g;return is4chan?(g=e.querySelector(".fileText"),g.appendChild(document.createTextNode(" "))):g=e.querySelector(".post_controls"),n=createElement(`<a href="javascript:;" class="${f}" data-id="${p}">${h}</a>`,g),n.onclick=()=>Player.play(Player.sounds.find(e=>e.id===p)),y.forEach(e=>Player.add(e,t)),y.length>0}catch(t){Player.logError("There was an issue parsing the files. Please check the console for details.",t),console.log("[4chan sounds player]",e)}}function o(e,t,r,o,l,i){if(!e)return[];e=e.replace(/-/,"/");const d=[];let c;for(;null!==(c=a.exec(e));)d.push(c);const u=d[0]&&d[0][1]||r||"Local Sound "+s;return d.length&&!r&&s++,d.reduce((a,c,y)=>{let p=c[2];const h=(r||"local"+s)+":"+y,f=c[1].trim()||u+(d.length>1?` (${y+1})`:"");try{p.includes("%")&&(p=decodeURIComponent(p)),p.startsWith("blob:")||null!==p.match(n)||(p=location.protocol+"//"+p)}catch(e){return a}const g={src:p,id:h,title:f,post:r,image:t,filename:e,thumb:o,imageMD5:l};return(i||Player.acceptedSound(g))&&a.push(g),a},[])}e.exports={parseFiles:function(e,t){let n=!1;(e.classList.contains("post")?[e]:e.querySelectorAll(".post")).forEach(e=>r(e,t)&&(n=!0)),n&&t&&Player.container&&Player.playlist.render()},parsePost:r,parseFileName:o}},function(e,t,n){"use strict";n.r(t);n(3);async function a(){if(!isChanX&&(isChanX=document.documentElement.classList.contains("fourchan-x")))return;const e=n(4),{parseFiles:t}=n(1);setTimeout((async function(){await e.initialize(),t(document.body,!0);new MutationObserver((function(e){e.forEach((function(e){"childList"===e.type&&e.addedNodes.forEach((function(e){e.nodeType===Node.ELEMENT_NODE&&t(e)}))}))})).observe(document.body,{childList:!0,subtree:!0})}),0)}document.addEventListener("4chanXInitFinished",(function(){const e=isChanX;isChanX=!0,e&&a(),Player.display.initChanX()})),isChanX||("loading"!==document.readyState?a():document.addEventListener("DOMContentLoaded",a))},function(e,t){function n(e,t){const n=Math.max(0,t-e);return[n%60,Math.floor(n/60)%60,Math.floor(n/60/60)%24,Math.floor(n/60/60/24)%7,Math.floor(n/60/60/24/7)]}window.ns="fc-sounds",window.is4chan=location.hostname.includes("4chan.org")||location.hostname.includes("4channel.org"),window.isChanX=document.documentElement.classList.contains("fourchan-x"),window.Board=location.pathname.split("/")[1],window._set=function(e,t,n){const a=t.split("."),s=a.pop(),r=a.reduce((e,t)=>e[t]||(e[t]={}),e);return r&&(r[s]=n),e},window._get=function(e,t,n){if("string"!=typeof t)return n;const a=t.split("."),s=a.pop(),r=a.reduce((e,t)=>e&&e[t],e);return r&&Object.prototype.hasOwnProperty.call(r,s)?r[s]:n},window._isEqual=function(e,t,n=!0){if(typeof e!=typeof t)return!1;if(Array.isArray(e,t))return e===t||e.length===t.length&&e.every((e,n)=>_isEqual(e,t[n]));if(e&&t&&"object"==typeof e&&e!==t){const n=Object.keys(e);return n.push(...Object.keys(t).filter(e=>!n.includes(e))),n.every(n=>_isEqual(e[n],t[n]))}return n?e===t:e==t},window.toDuration=function(e){e=Math.floor(e||0);let[t,a,s]=n(0,e);return t<10&&(t="0"+t),(s?s+":":"")+a+":"+t},window.timeAgo=function(e){const[t,a,s,r,o]=n(Math.floor(e),Math.floor(Date.now()/1e3));return o>1?o+" weeks ago":r>0?r+(1===r?" day":" days")+" ago":s>0?s+(1===s?" hour":" hours")+" ago":a>0?a+(1===a?" minute":" minutes")+" ago":t+(1===t?" second":" seconds")+" ago"},window.createElement=function(e,t,n={}){const a=document.createElement("div");a.innerHTML=e;const s=a.children[0];t&&t.appendChild(s);for(let e in n)s.addEventListener(e,n[e]);return s},window.createElementBefore=function(e,t,n={}){const a=createElement(e,null,n);return t.parentNode.insertBefore(a,t),a},window.noDefault=(e,...t)=>n=>{n.preventDefault();("function"==typeof e?e:_get(Player,e))(n,...t)};class a extends Error{constructor(e,t,n){super(e),this.reason=e,this.type=t,this.error=n}}window.PlayerError=a},function(e,t,n){const a={settings:n(5),controls:n(11),display:n(12),events:n(13),footer:n(14),header:n(15),hotkeys:n(16),minimised:n(17),playlist:n(18),position:n(19),threads:n(20),tools:n(22),userTemplate:n(23)},s=window.Player=e.exports={ns:ns,audio:new Audio,sounds:[],isHidden:!0,container:null,ui:{},config:{},$:(...e)=>s.container&&s.container.querySelector(...e),$all:(...e)=>s.container&&s.container.querySelectorAll(...e),components:a,templates:{body:n(25),controls:n(26),css:n(27),footer:n(28),header:n(29),hostInput:n(30),itemMenu:n(31),list:n(32),player:n(33),settings:n(34),threads:n(35),threadBoards:n(36),threadList:n(37),tools:n(38),viewsMenu:n(39)},initialize:async function(){if(!s.initialized){s.initialized=!0;try{s.sounds=[];for(let e in a)a[e].initialize&&await a[e].initialize();if(is4chan)isChanX?s.display.initChanX():document.querySelectorAll("#settingsWindowLink, #settingsWindowLinkBot").forEach((function(e){const t=createElement('<a href="javascript:;">Sounds</a>',null,{click:s.display.toggle});e.parentNode.insertBefore(t,e),e.parentNode.insertBefore(document.createTextNode("] ["),e)}));else{const e=document.querySelector(".navbar-inner .nav:nth-child(2)");createElement('<li><a href="javascript:;">Sounds</a></li>',e).children[0].addEventListener("click",s.display.toggle)}s.display.render()}catch(e){throw s.logError("There was an error initialzing the sound player. Please check the console for details.",e),e}}},compareIds:function(e,t){const[n,a]=e.split(":"),[s,r]=t.split(":"),o=n-s;return 0!==o?o:a-r},acceptedSound:function({src:e,imageMD5:t}){try{const n=new URL(e),a=n.hostname.toLowerCase();return!s.config.filters.find(e=>e===t||e===a+n.pathname)&&s.config.allow.find(e=>a===e||a.endsWith("."+e))}catch(e){return!1}},syncTab:(e,t)=>"undefined"!=typeof GM_addValueChangeListener&&GM_addValueChangeListener(e,(e,n,a,s)=>{s&&t(a,n)}),logError:function(e,t,n){console.error("[4chan sounds player]",e,t),t instanceof PlayerError&&(t.error&&console.error("[4chan sound player]",t.error),e=t.reason,n=t.type||n),document.dispatchEvent(new CustomEvent("CreateNotification",{bubbles:!0,detail:{type:n||"error",content:e,lifetime:5}}))}};for(let e in a)s[e]=a[e],(s[e].atRoot||[]).forEach(t=>s[t]=s[e][t])},function(e,t,n){const a=n(0);e.exports={atRoot:["set"],delegatedEvents:{click:{[`.${ns}-settings .${ns}-heading-action`]:"settings._handleAction",[`.${ns}-settings-tab`]:"settings._handleTab"},focusout:{[`.${ns}-settings input, .${ns}-settings textarea`]:"settings._handleChange"},change:{[`.${ns}-settings input[type=checkbox], .${ns}-settings select`]:"settings._handleChange"},keydown:{[`.${ns}-key-input`]:"settings.handleKeyChange"}},initialize:async function(){Player.settings.view="Display",Player.settings.applyBoardTheme(),Player.config=a.reduce((function(e,t){return t.settings?(t.settings.forEach(n=>{let a={...t,...n};_set(e,a.property,a.default)}),e):_set(e,t.property,t.default)}),{}),await Player.settings.load(),Player.on("hide",(function(){Player.config.pauseOnHide&&Player.pause()})),Player.syncTab("settings",e=>Player.settings.apply(e,{bypassSave:!0,applyDefault:!0,ignore:["viewStyle"]}))},render:function(){Player.container&&(Player.$(`.${ns}-settings`).innerHTML=Player.templates.settings())},forceBoardTheme:function(){Player.settings.applyBoardTheme(!0),Player.settings.save()},applyBoardTheme:function(e){const t=createElement(`<div class="${is4chan?"post reply style-fetcher":"post_wrapper"}"></div>`,document.body),n=document.defaultView.getComputedStyle(t),s={"colors.text":"color","colors.background":"backgroundColor","colors.odd_row":"backgroundColor","colors.border":"borderBottomColor","colors.even_row":n.borderBottomColor===n.color?"backgroundColor":"borderBottomColor"};a.find(e=>"colors"===e.property).settings.forEach(t=>{const a=e||t.default===_get(Player.config,t.property);s[t.property]&&(t.default=n[s[t.property]]),a&&Player.set(t.property,t.default,{bypassSave:!0,bypassRender:!0})}),document.body.removeChild(t),Player.stylesheet&&Player.display.updateStylesheet(),Player.settings.render()},set:function(e,t,{bypassValidation:n,bypassSave:a,bypassRender:s,silent:r}={}){const o=_get(Player.config,e);!n&&_isEqual(o,t)||(_set(Player.config,e,t),!r&&Player.trigger("config",e,t,o),!r&&Player.trigger("config:"+e,t,o),!a&&Player.settings.save(),!s&&Player.settings.findDefault(e).displayGroup&&Player.settings.render())},reset:function(e){let t=Player.settings.findDefault(e);Player.set(e,t.default)},save:function(){try{const e=a.reduce((function e(t,n){if(n.settings)n.settings.forEach(a=>e(t,{property:n.property,default:n.default,...a}));else{let e=_get(Player.config,n.property);void 0===e||_isEqual(e,n.default)||(n.mix&&(e=Object.keys(e).reduce((t,a)=>(_isEqual(n.default[a],e[a])||(t[a]=e[a]),t),{})),_set(t,n.property,e))}return t}),{});return e.viewStyle=Player.playlist._lastView,e.VERSION="3.0.0-32b5b39",GM.setValue("settings",JSON.stringify(e))}catch(e){Player.logError("There was an error saving the sound player settings.",e)}},load:async function(){try{let e=await GM.getValue("settings")||await GM.getValue(ns+".settings");e&&Player.settings.apply(e,{bypassSave:!0,silent:!0})}catch(e){Player.logError("There was an error loading the sound player settings.",e)}},apply:function(e,t={}){"string"==typeof e&&(e=JSON.parse(e)),a.forEach((function n(a){if(a.settings)return a.settings.forEach(e=>n({property:a.property,default:a.default,...e}));if(t.ignore&&t.ignore.includes(a.property))return;let s=_get(e,a.property,t.applyDefault?a.default:void 0);void 0!==s&&(a.mix&&(s={...a.default,...s||{}}),Player.set(a.property,s,t))}))},findDefault:function(e){let t;return a.find((function(n){if(n.property===e)return t=n;if(n.settings){let a=n.settings.find(t=>t.property===e);return a&&(t={...n,settings:null,...a})}return!1})),t||{property:e}},toggle:function(e){e&&e.preventDefault();let t=Player.$(`.${ns}-settings :focus`);t&&t.blur(),"settings"===Player.config.viewStyle?Player.playlist.restore():Player.display.setViewStyle("settings")},_handleTab:function(e){const t=e.eventTarget.getAttribute("data-group");if(t){e.preventDefault(),Player.settings.view=t;const n=Player.$(`.${ns}-settings-group.active`),a=Player.$(`.${ns}-settings-tab.active`);n&&n.classList.remove("active"),a&&a.classList.remove("active"),Player.$(`.${ns}-settings-group[data-group="${t}"]`).classList.add("active"),Player.$(`.${ns}-settings-tab[data-group="${t}"]`).classList.add("active")}},_handleChange:function(e){try{const t=e.eventTarget,n=t.getAttribute("data-property");if(!n)return;let a=Player.settings.findDefault(n);const s=_get(Player.config,n);let r=t["checkbox"===t.getAttribute("type")?"checked":"value"];a.parse&&(r=_get(Player,a.parse)(r,s,e)),a&&a.split&&(r=r.split(decodeURIComponent(a.split))),_isEqual(s,r,!a.looseCompare)||(Player.set(n,r,{bypassValidation:!0,bypassRender:!0}),a.updateStylesheet&&Player.display.updateStylesheet()),a&&a.handler&&_get(Player,a.handler,()=>null)(r)}catch(e){Player.logError("There was an error updating the setting.",e)}},handleKeyChange:function(e){e.preventDefault(),"Shift"!==e.key&&"Control"!==e.key&&"Meta"!==e.key&&(e.eventTarget.value=Player.hotkeys.stringifyKey(e))},_handleAction:function(e){e.preventDefault();const t=e.eventTarget.getAttribute("data-property"),n=e.eventTarget.getAttribute("data-handler"),a=_get(Player,n);a&&a(t,e)},renderHosts:function(e){return`<div class="${ns}-host-inputs">`+Object.keys(Player.config.uploadHosts).map(Player.templates.hostInput).join("")+"</div>"},parseHosts:function(e,t,n){t={...t};const a=n.eventTarget.closest(`.${ns}-host-input`);let s=a.getAttribute("data-host-name"),r=t[s]={...t[s]};const o=n.eventTarget.getAttribute("name");try{if("name"===o&&e!==s){if(!e||t[e])throw new PlayerError("A unique name for the host is required.","warning");a.setAttribute("data-host-name",e),t[e]=r,delete t[s],s=e}if("url"===o||"soundUrl"===o)try{("url"===o||e)&&new URL(e)}catch(e){throw new PlayerError("The value must be a valid URL.","warning")}if("data"===o)try{e=JSON.parse(e)}catch(e){throw new PlayerError("The data must be valid JSON.","warning")}if("headers"===o)try{e=e?JSON.parse(e):void 0}catch(e){throw new PlayerError("The headers must be valid JSON.","warning")}}catch(e){throw r.invalid=!0,a.classList.add("invalid"),e}void 0===e?delete r[o]:r[o]=e;try{const e=a.querySelector("[name=soundUrl]").value,t=a.querySelector("[name=headers]").value;!(s&&JSON.parse(a.querySelector("[name=data]").value)&&new URL(a.querySelector("[name=url]").value))||e&&!new URL(e)||t&&!JSON.parse(t)||(delete r.invalid,a.classList.remove("invalid"))}catch(e){}return t},addUploadHost:function(){const e=Player.config.uploadHosts,t=Player.$(`.${ns}-host-inputs`);let n="New Host",a=1;for(;Player.config.uploadHosts[n];)n=n+" "+ ++a;e[n]={invalid:!0,data:{file:"$file"}},t.children[0]?createElementBefore(Player.templates.hostInput(n),t.children[0]):createElement(Player.templates.hostInput(n),t),Player.settings.set("uploadHosts",e,{bypassValidation:!0,bypassRender:!0,silent:!0})},removeHost:function(e,t){const n=Player.config.uploadHosts,a=t.eventTarget.closest(`.${ns}-host-input`),s=a.getAttribute("data-host-name");Player.settings.findDefault("uploadHosts").default[s]?n[s]=null:delete n[s],a.parentNode.removeChild(a),Player.settings.set("uploadHosts",n,{bypassValidation:!0,bypassRender:!0})},setDefaultHost:function(e,t,n){const a=n.eventTarget.closest(`.${ns}-host-input`).getAttribute("data-host-name");return a===Player.config.defaultUploadHost||Object.keys(Player.config.uploadHosts).forEach(e=>{const t=Player.$(`.${ns}-host-input[data-host-name="${e}"] input[data-property="defaultUploadHost"]`);t&&(t.checked=e===a)}),a},restoreDefaultHosts:function(){Object.assign(Player.config.uploadHosts,Player.settings.findDefault("uploadHosts").default),Player.set("uploadHosts",Player.config.uploadHosts,{bypassValidation:!0})}}},function(e,t){e.exports=[{property:"autoshow",default:!0,title:"Autoshow",description:"Automatically show the player when the thread contains sounds.",displayGroup:"Display",settings:[{title:"Enabled"}]},{property:"pauseOnHide",default:!0,title:"Pause on hide",description:"Pause the player when it's hidden.",displayGroup:"Display",settings:[{title:"Enabled"}]},{title:"Minimised Display",description:"Optional displays for when the player is minimised.",displayGroup:"Display",settings:[{property:"pip",title:"Thumbnail",description:"Display a fixed thumbnail of the playing sound in the bottom right of the thread.",default:!0},{property:"maxPIPWidth",title:"Max Width",description:"Maximum width for the thumbnail.",default:"150px",updateStylesheet:!0},{property:"chanXControls",title:"4chan X Header Controls",description:"Show playback controls in the 4chan X header. Customise the template below.",displayMethod:isChanX||null,options:{always:"Always",closed:"Only with the player closed",never:"Never"}}]},{property:"limitPostWidths",title:"Limit Post Width",description:"Limit the width of posts so they aren't hidden under the player.",displayGroup:"Display",settings:[{property:"limitPostWidths",title:"Enabled",default:!0},{property:"minPostWidth",title:"Minimum Width",default:"50%"}]},{property:"threadsViewStyle",title:"Threads View",description:"How threads in the threads view are listed.",displayGroup:"Display",settings:[{title:"Display",default:"table",options:{table:"Table",board:"Board"}}]},{title:"Colors",displayGroup:"Display",property:"colors",updateStylesheet:!0,actions:[{title:"Match Theme",handler:"settings.forceBoardTheme"}],settings:[{property:"colors.text",default:"#000000",title:"Text Color"},{property:"colors.background",default:"#d6daf0",title:"Background Color"},{property:"colors.border",default:"#b7c5d9",title:"Border Color"},{property:"colors.odd_row",default:"#d6daf0",title:"Odd Row Color"},{property:"colors.even_row",default:"#b7c5d9",title:"Even Row Color"},{property:"colors.playing",default:"#98bff7",title:"Playing Row Color"},{property:"colors.dragging",default:"#c396c8",title:"Dragging Row Color"}]}]},function(e,t){e.exports=[{property:"allow",title:"Allowed Hosts",description:"Which domains sources are allowed to be loaded from.",default:["4cdn.org","catbox.moe","dmca.gripe","lewd.se","pomf.cat","zz.ht"],actions:[{title:"Reset",handler:"settings.reset"}],displayGroup:"Filter",split:"\n"},{property:"filters",default:["# Image MD5 or sound URL"],title:"Filters",description:"List of URLs or image MD5s to filter, one per line.\nLines starting with a # will be ignored.",actions:[{title:"Reset",handler:"settings.reset"}],displayGroup:"Filter",split:"\n"}]},function(e,t){e.exports=[{title:"Keybinds",displayGroup:"Keybinds",description:"Enable keyboard shortcuts.",format:"hotkeys.stringifyKey",parse:"hotkeys.parseKey",class:ns+"-key-input",property:"hotkey_bindings",settings:[{property:"hotkeys",default:"open",handler:"hotkeys.apply",title:"Enabled",format:null,parse:null,class:null,options:{always:"Always",open:"Only with the player open",never:"Never"}},{property:"hotkey_bindings.playPause",title:"Play/Pause",keyHandler:"togglePlay",ignoreRepeat:!0,default:{key:" "}},{property:"hotkey_bindings.previous",title:"Previous",keyHandler:"previous",ignoreRepeat:!0,default:{key:"arrowleft"}},{property:"hotkey_bindings.next",title:"Next",keyHandler:"next",ignoreRepeat:!0,default:{key:"arrowright"}},{property:"hotkey_bindings.previousGroup",title:"Previous Group",keyHandler:()=>Player.previous({group:!0}),ignoreRepeat:!0,default:{shiftKey:!0,key:"arrowleft"}},{property:"hotkey_bindings.nextGroup",title:"Next Group",keyHandler:()=>Player.next({group:!0}),ignoreRepeat:!0,default:{shiftKey:!0,key:"arrowright"}},{property:"hotkey_bindings.volumeUp",title:"Volume Up",keyHandler:"hotkeys.volumeUp",default:{shiftKey:!0,key:"arrowup"}},{property:"hotkey_bindings.volumeDown",title:"Volume Down",keyHandler:"hotkeys.volumeDown",default:{shiftKey:!0,key:"arrowdown"}},{property:"hotkey_bindings.toggleFullscreen",title:"Toggle Fullscreen",keyHandler:"display.toggleFullScreen",default:{key:""}},{property:"hotkey_bindings.togglePlayer",title:"Show/Hide",keyHandler:"display.toggle",default:{key:"h"}},{property:"hotkey_bindings.togglePlaylist",title:"Toggle Playlist",keyHandler:"playlist.toggleView",default:{key:""}},{property:"hotkey_bindings.toggleSearch",title:"Toggle Playlist Search",keyHandler:()=>Player.set("showPlaylistSearch",!Player.config.showPlaylistSearch),default:{key:""}},{property:"hotkey_bindings.scrollToPlaying",title:"Jump To Playing",keyHandler:"playlist.scrollToPlaying",default:{key:""}},{property:"hotkey_bindings.toggleHoverImages",title:"Toggle Hover Images",keyHandler:"playlist.toggleHoverImages",default:{key:""}}]}]},function(e,t){e.exports=[{property:"headerTemplate",title:"Header",actions:[{title:"Reset",handler:"settings.reset"}],default:"repeat-button shuffle-button hover-images-button playlist-button\nsound-name\nview-menu-button add-button reload-button close-button",displayGroup:"Templates",displayMethod:"textarea"},{property:"rowTemplate",title:"Row",actions:[{title:"Reset",handler:"settings.reset"}],default:"sound-name h:{menu-button}",displayGroup:"Templates",displayMethod:"textarea"},{property:"footerTemplate",title:"Footer",actions:[{title:"Reset",handler:"settings.reset"}],default:'playing-button:"sound-index /" sound-count sounds\np:{\n\t<div style="float: right; margin-right: .5rem">\n\t\tpost-link\n\t\tOpen [ image-link sound-link ]\n\t\tDownload [ dl-image-button dl-sound-button ]\n\t</div>\n}',description:"Template for the footer contents",displayGroup:"Templates",displayMethod:"textarea",attrs:'style="height:120px;"'},{property:"chanXTemplate",title:"4chan X Header",default:'p:{\n\tpost-link:"sound-name"\n\tprev-button\n\tplay-button\n\tnext-button\n\tsound-current-time / sound-duration\n}',actions:[{title:"Reset",handler:"settings.reset"}],displayGroup:"Templates",displayMethod:"textarea"}]},function(e,t){e.exports=[{property:"defaultUploadHost",default:"catbox",parse:"settings.setDefaultHost"},{property:"uploadHosts",title:"Hosts",actions:[{title:"Add",handler:"settings.addUploadHost"},{title:"Restore Defaults",handler:"settings.restoreDefaultHosts"}],displayGroup:"Hosts",displayMethod:"settings.renderHosts",parse:"settings.parseHosts",looseCompare:!0,dismissTextId:"uplodHostSettings",dismissRestoreText:"Show Help",text:"Properties<br><strong>Name</strong>: A unique identifier.<br><strong>URL</strong>: The URL to post the file to.<br><strong>Response Path/Match</strong>: A key path or regular expression to locate the uploaded filename in the response.<br><strong>File URL Format</strong>: The URL format for uploaded sounds. %s is replaced with the result of response path/match if given or the full response.<br><strong>Data</strong>: The form data for the upload (as JSON). Specify the file using $file.",mix:!0,default:{catbox:{default:!0,url:"https://catbox.moe/user/api.php",data:{reqtype:"fileupload",fileToUpload:"$file",userhash:null}},pomf:{url:"https://pomf.cat/upload.php",data:{"files[]":"$file"},responsePath:"files.0.url"},zz:{url:"https://zz.ht/api/upload",responsePath:"files.0.url",data:{"files[]":"$file"},headers:{token:null}},lewd:{url:"https://lewd.se/upload",data:{file:"$file"},headers:{token:null,shortUrl:!0},responsePath:"data.link"}}}]},function(e,t){const n={};e.exports={atRoot:["togglePlay","play","pause","next","previous"],delegatedEvents:{click:{[`.${ns}-previous-button`]:()=>Player.previous(),[`.${ns}-play-button`]:"togglePlay",[`.${ns}-next-button`]:()=>Player.next(),[`.${ns}-seek-bar`]:"controls.handleSeek",[`.${ns}-volume-bar`]:"controls.handleVolume",[`.${ns}-fullscreen-button`]:"display.toggleFullScreen"},mousedown:{[`.${ns}-seek-bar`]:()=>Player._seekBarDown=!0,[`.${ns}-volume-bar`]:()=>Player._volumeBarDown=!0},mousemove:{[`.${ns}-seek-bar`]:e=>Player._seekBarDown&&Player.controls.handleSeek(e),[`.${ns}-volume-bar`]:e=>Player._volumeBarDown&&Player.controls.handleVolume(e)}},undelegatedEvents:{mouseleave:{[`.${ns}-seek-bar`]:e=>Player._seekBarDown&&Player.controls.handleSeek(e),[`.${ns}-volume-bar`]:e=>Player._volumeBarDown&&Player.controls.handleVolume(e)},mouseup:{body:()=>{Player._seekBarDown=!1,Player._volumeBarDown=!1}},play:{[`.${ns}-video`]:"controls.syncVideo"},pause:{[`.${ns}-video`]:"controls.syncVideo"}},audioEvents:{ended:()=>Player.next(),pause:"controls.handleAudioEvent",play:"controls.handleAudioEvent",seeked:"controls.handleAudioEvent",waiting:"controls.handleAudioEvent",timeupdate:"controls.updateDuration",loadedmetadata:"controls.updateDuration",durationchange:"controls.updateDuration",volumechange:"controls.updateVolume",loadstart:"controls.pollForLoading"},initialize:function(){Player.on("show",()=>Player._hiddenWhilePolling&&Player.controls.pollForLoading()),Player.on("hide",()=>{Player._hiddenWhilePolling=!!Player._loadingPoll,Player.controls.stopPollingForLoading()}),Player.on("rendered",()=>{Player.ui.currentTimeBar=Player.$(`.${ns}-seek-bar .${ns}-current-bar`),Player.ui.loadedBar=Player.$(`.${ns}-seek-bar .${ns}-loaded-bar`),document.head.appendChild(n[`.${ns}-seek-bar`]=document.createElement("style")),document.head.appendChild(n[`.${ns}-volume-bar`]=document.createElement("style")),Player.controls.updateDuration(),Player.controls.updateVolume()})},togglePlay:function(){Player.audio.paused?Player.play():Player.pause()},play:async function(e){try{e||Player.playing||!Player.sounds.length||(e=Player.sounds[0]);const t=document.querySelector(`.${ns}-video`);t.removeEventListener("loadeddata",Player.controls.playOnceLoaded),e&&(Player.playing&&(Player.playing.playing=!1),e.playing=!0,Player.playing=e,Player.audio.src=e.src,await Player.trigger("playsound",e)),Player.playlist.isVideo&&(t.readyState<3||Player.audio.readyState<3)?(t.addEventListener("loadeddata",Player.controls._playOnceLoaded),Player.audio.addEventListener("loadeddata",Player.controls._playOnceLoaded)):Player.audio.play()}catch(e){Player.logError("There was an error playing the sound. Please check the console for details.",e)}},_playOnceLoaded:function(){const e=document.querySelector(`.${ns}-video`);e.readyState>2&&Player.audio.readyState>2&&(e.removeEventListener("loadeddata",Player.controls._playOnceLoaded),Player.audio.removeEventListener("loadeddata",Player.controls._playOnceLoaded),Player.audio.play())},pause:function(){Player.audio&&Player.audio.pause()},next:function(e){Player.controls._movePlaying(1,e)},previous:function(e){Player.controls._movePlaying(-1,e)},_movePlaying:function(e,{force:t,group:n}={}){if(!Player.audio)return;if(!Player.sounds.length)return;const a=Player.sounds.indexOf(Player.playing);if(-1===a)return Player.play(Player.sounds[0]);let s;if(t||"one"!==Player.config.repeat){let t=a;do{t="all"===Player.config.repeat?(t+e+Player.sounds.length)%Player.sounds.length:t+e,s=Player.sounds[t]}while(n&&s&&t!==a&&(!s.post||s.post===Player.playing.post))}else s=Player.sounds[a];s&&Player.play(s)},handleAudioEvent:function(){Player.controls.syncVideo(),Player.controls.updateDuration(),document.querySelectorAll(`.${ns}-play-button .${ns}-play-button-display`).forEach(e=>{e.classList[Player.audio.paused?"add":"remove"](ns+"-play")})},syncVideo:function(){if(Player.playlist.isVideo){const e=Player.audio.paused,t=document.querySelector(`.${ns}-video`);t&&(Player.audio.currentTime<t.duration&&(t.currentTime=Player.audio.currentTime),e?t.pause():t.play())}},pollForLoading:function(){Player._loadingPoll=Player._loadingPoll||setInterval(Player.controls.updateLoaded,1e3)},stopPollingForLoading:function(){Player._loadingPoll&&clearInterval(Player._loadingPoll),Player._loadingPoll=null},updateLoaded:function(){const e=Player.audio.buffered.length,t=e>0?Player.audio.buffered.end(e-1)/Player.audio.duration*100:0;100===t&&Player.controls.stopPollingForLoading(),Player.ui.loadedBar.style.width=t+"%"},updateDuration:function(){if(!Player.container)return;const e=toDuration(Player.audio.currentTime),t=toDuration(Player.audio.duration);document.querySelectorAll(`.${ns}-current-time`).forEach(t=>t.innerHTML=e),document.querySelectorAll(`.${ns}-duration`).forEach(e=>e.innerHTML=t),Player.controls.updateProgressBarPosition(`.${ns}-seek-bar`,Player.ui.currentTimeBar,Player.audio.currentTime,Player.audio.duration)},updateVolume:function(){Player.controls.updateProgressBarPosition(`.${ns}-volume-bar`,Player.$(`.${ns}-volume-bar .${ns}-current-bar`),Player.audio.volume,1)},updateProgressBarPosition:function(e,t,a,s){a||(a=0),s||(s=0);const r=s?Math.max(0,Math.min((a||0)/s,1)):0;t.style.width=100*r+"%",n[e]&&(n[e].innerHTML=`${e} .${ns}-current-bar:after {\n\t\t\t\tmargin-right: ${-.8*(1-r)}rem;\n\t\t\t}`)},handleSeek:function(e){if(e.preventDefault(),Player.container&&Player.audio.duration&&Player.audio.duration!==1/0){const t=e.offsetX/parseInt(document.defaultView.getComputedStyle(e.eventTarget||e.target).width,10);Player.audio.currentTime=Player.audio.duration*t}},handleVolume:function(e){if(e.preventDefault(),!Player.container)return;const t=e.offsetX/parseInt(document.defaultView.getComputedStyle(e.eventTarget||e.target).width,10);Player.audio.volume=Math.max(0,Math.min(t,1)),Player.controls.updateVolume()}}},function(e,t){const n={},a={};e.exports={atRoot:["show","hide"],delegatedEvents:{click:{[`.${ns}-close-button`]:"hide",[`.${ns}-dismiss-link`]:"display._handleDismiss",[`.${ns}-restore-link`]:"display._handleRestore"},fullscreenchange:{[`.${ns}-media`]:"display._handleFullScreenChange"},drop:{[`#${ns}-container`]:"display._handleDrop"}},initialize:async function(){try{Player.display.dismissed=(await GM.getValue("dismissed")).split(",")}catch(e){Player.display.dismissed=[]}},initChanX:function(){if(Player.display._initedChanX)return;const e=document.getElementById("shortcuts");if(!e)return;Player.display._initedChanX=!0;const t=createElement('<span id="shortcut-sounds" class="shortcut brackets-wrap" data-index="0">\n\t\t\t<a href="javascript:;" title="Sounds" class="fa fa-play-circle">Sounds</a>\n\t\t</span>');e.insertBefore(t,document.getElementById("shortcut-settings")),t.querySelector("a").addEventListener("click",Player.display.toggle)},render:async function(){try{Player.container&&(document.body.removeChild(Player.container),document.head.removeChild(Player.stylesheet)),Player.display.updateStylesheet();const e=document.body.classList.contains("is_thread")&&!isChanX&&document.body.querySelector(".board")||document.body;Player.container=createElement(Player.templates.body(),e),Player.trigger("rendered")}catch(e){throw Player.logError("There was an error rendering the sound player.",e),e}},updateStylesheet:function(){Player.stylesheet=Player.stylesheet||createElement("<style></style>",document.head),Player.stylesheet.innerHTML=Player.templates.css()},setViewStyle:function(e){const t=Player.config.viewStyle,{width:n,height:a}=Player.container.getBoundingClientRect();"fullscreen"!==e&&document.fullscreenElement&&document.exitFullscreen(),Player.set("viewStyle",e),Player.container.setAttribute("data-view-style",e),"fullscreen"===t&&"fullscreen"!==e||Player.position.resize(parseInt(n,10),parseInt(a,10)),Player.trigger("view",e,t)},toggle:function(e){e&&e.preventDefault(),"none"===Player.container.style.display?Player.show():Player.hide()},hide:function(e){Player.container&&(e&&e.preventDefault(),Player.container.style.display="none",Player.isHidden=!0,Player.trigger("hide"))},show:async function(e){Player.container&&(e&&e.preventDefault(),Player.container.style.display&&(Player.container.style.display=null,Player.isHidden=!1,await Player.trigger("show")))},toggleFullScreen:async function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():(Player.isHidden&&Player.show(),Player.$(`.${ns}-media`).requestFullscreen())},_handleDrop:function(e){e.preventDefault(),e.stopPropagation(),Player.playlist.addFromFiles(e.dataTransfer.files)},_handleFullScreenChange:function(){document.fullscreenElement?(Player.display.setViewStyle("fullscreen"),document.querySelector(`.${ns}-image-link`).removeAttribute("href")):(Player.playing&&(document.querySelector(`.${ns}-image-link`).href=Player.playing.image),Player.playlist.restore())},_handleRestore:async function(e){e.preventDefault();const t=e.eventTarget.getAttribute("data-restore"),a=Player.display.dismissed.indexOf(t);t&&a>-1&&(Player.display.dismissed.splice(a,1),Player.$all(`[data-restore="${t}"]`).forEach(e=>{createElementBefore(n[t],e),e.parentNode.removeChild(e)}),await GM.setValue("dismissed",Player.display.dismissed.join(",")))},_handleDismiss:async function(e){e.preventDefault();const t=e.eventTarget.getAttribute("data-dismiss");t&&!Player.display.dismissed.includes(t)&&(Player.display.dismissed.push(t),Player.$all(`[data-dismiss-id="${t}"]`).forEach(e=>{createElementBefore(`<a href="#" class="${ns}-restore-link" data-restore="${t}">${a[t]}</a>`,e),e.parentNode.removeChild(e)}),await GM.setValue("dismissed",Player.display.dismissed.join(",")))},ifNotDismissed:function(e,t,s){return n[e]=s,a[e]=t,Player.display.dismissed.includes(e)?`<a href="#" class="${ns}-restore-link" data-restore="${e}">${t}</a>`:s}}},function(e,t){e.exports={atRoot:["on","off","trigger"],_events:{},_delegatedEvents:{},_undelegatedEvents:{},_audioEvents:[],initialize:function(){const e={Player:Player,...Player.components},t=Player.events._delegatedEvents,n=Player.events._undelegatedEvents,a=Player.events._audioEvents;for(let s in e){const r=e[s];for(let e in r.delegatedEvents||{})t[e]||(t[e]=[]),t[e].push(r.delegatedEvents[e]);for(let e in r.undelegatedEvents||{})n[e]||(n[e]=[]),n[e].push(r.undelegatedEvents[e]);r.audioEvents&&a.push(r.audioEvents)}Player.on("rendered",(function(){Player.events.addDelegatedListeners(Player.container,t),Player.events.addUndelegatedListeners(document,n);for(let e of a)for(let t in e)Player.audio.addEventListener(t,Player.events.getHandler(e[t]))}))},addDelegatedListeners(e,t){for(let n in t)e.addEventListener(n,(function(a){let s=[a.target];for(;s[s.length-1]!==e;)s.push(s[s.length-1].parentNode);for(let e of s)for(let s of[].concat(t[n]))for(let t in s)if(e.matches&&e.matches(t)){a.eventTarget=e;let n=Player.events.getHandler(s[t]);if(n&&!1===n(a))return}}))},addUndelegatedListeners:function(e,t){for(let n in t)for(let a of[].concat(t[n]))for(let t in a)e.querySelectorAll(t).forEach(e=>{const s=Player.events.getHandler(a[t]);e.removeEventListener(n,s),e.addEventListener(n,s)})},on:function(e,t){Player.events._events[e]||(Player.events._events[e]=[]),Player.events._events[e].push(t)},off:function(e,t){const n=Player.events._events[e]&&Player.events._events[e].indexOf(t);n>-1&&Player.events._events[e].splice(n,1)},trigger:async function(e,...t){const n=Player.events._events[e]||[];for(let e of n)await e(...t)},getHandler:function(e){return"string"==typeof e?_get(Player,e):e}}},function(e,t){e.exports={initialize:function(){Player.userTemplate.maintain(Player.footer,"footerTemplate")},render:function(){Player.container&&(Player.$(`.${ns}-footer`).innerHTML=Player.templates.footer())}}},function(e,t){e.exports={initialize:function(){Player.userTemplate.maintain(Player.header,"headerTemplate")},render:function(){Player.container&&(Player.$(`.${ns}-header`).innerHTML=Player.templates.header())}}},function(e,t,n){const a=n(0);e.exports={initialize:function(){Player.on("rendered",Player.hotkeys.apply)},_keyMap:{" ":"space",arrowleft:"left",arrowright:"right",arrowup:"up",arrowdown:"down"},addHandler:()=>{Player.hotkeys.removeHandler(),document.body.addEventListener("keydown",Player.hotkeys.handle)},removeHandler:()=>{document.body.removeEventListener("keydown",Player.hotkeys.handle)},apply:function(){const e=Player.config.hotkeys;Player.hotkeys.removeHandler(),Player.off("show",Player.hotkeys.addHandler),Player.off("hide",Player.hotkeys.removeHandler),"always"===e?Player.hotkeys.addHandler():"open"===e&&(Player.isHidden||Player.hotkeys.addHandler(),Player.on("show",Player.hotkeys.addHandler),Player.on("hide",Player.hotkeys.removeHandler))},handle:function(e){if(["INPUT","SELECT","TEXTAREA","INPUT"].includes(e.target.nodeName)||Player.isHidden&&("always"!==Player.config.hotkeys||!Player.sounds.length))return;const t=e.key.toLowerCase(),n=Player.config.hotkey_bindings||{};for(let s in n){const r=n[s],o=t===r.key&&!!r.shiftKey==!!e.shiftKey&&!!r.ctrlKey==!!e.ctrlKey&&!!r.metaKey==!!e.metaKey&&(!r.ignoreRepeat||!e.repeat)&&a.find(e=>"hotkey_bindings"===e.property).settings.find(e=>e.property==="hotkey_bindings."+s);if(o)return e.preventDefault(),Player.events.getHandler(o.keyHandler)()}},stringifyKey:function(e){let t=e.key.toLowerCase();return Player.hotkeys._keyMap[t]&&(t=Player.hotkeys._keyMap[t]),(e.ctrlKey?"Ctrl+":"")+(e.shiftKey?"Shift+":"")+(e.metaKey?"Meta+":"")+t},parseKey:function(e){const t=e.split("+");let n=t.pop();Object.keys(Player.hotkeys._keyMap).find(e=>Player.hotkeys._keyMap[e]===n&&(n=e));const a={key:n};return t.forEach(e=>a[e.toLowerCase()+"Key"]=!0),a},volumeUp:function(){Player.audio.volume=Math.min(Player.audio.volume+.05,1)},volumeDown:function(){Player.audio.volume=Math.max(Player.audio.volume-.05,0)}}},function(e,t){e.exports={_showingPIP:!1,initialize:function(){if(isChanX){const e=createElement("<a></a>",document.body),t=document.defaultView.getComputedStyle(e);createElement(`<style>.${ns}-chan-x-controls .${ns}-media-control > div { background: ${t.color} }</style>`,document.head),document.body.removeChild(e),Player.userTemplate.maintain(Player.minimised,"chanXTemplate",["chanXControls"],["show","hide"])}Player.on("rendered",Player.minimised.render),Player.on("show",Player.minimised.hidePIP),Player.on("hide",Player.minimised.showPIP),Player.on("playsound",Player.minimised.showPIP)},render:function(){if(Player.container&&isChanX){let e=document.querySelector(`.${ns}-chan-x-controls`);if(e||(e=createElementBefore(`<span class="${ns}-chan-x-controls ${ns}-col-auto"></span>`,document.querySelector("#shortcuts").firstElementChild),Player.events.addDelegatedListeners(e,{click:[Player.userTemplate.delegatedEvents.click,Player.controls.delegatedEvents.click]})),"never"===Player.config.chanXControls||"closed"===Player.config.chanXControls&&!Player.isHidden)return e.innerHTML="";e.innerHTML=Player.userTemplate.build({template:Player.config.chanXTemplate,sound:Player.playing,replacements:{"prev-button":`<div class="${ns}-media-control ${ns}-previous-button"><div class="${ns}-previous-button-display"></div></div>`,"play-button":`<div class="${ns}-media-control ${ns}-play-button"><div class="${ns}-play-button-display ${!Player.audio||Player.audio.paused?ns+"-play":""}"></div></div>`,"next-button":`<div class="${ns}-media-control ${ns}-next-button"><div class="${ns}-next-button-display"></div></div>`,"sound-current-time":`<span class="${ns}-current-time">0:00</span>`,"sound-duration":`<span class="${ns}-duration">0:00</span>`}})}},showPIP:function(){if(!Player.isHidden||!Player.config.pip||!Player.playing||Player.minimised._showingPIP)return;Player.minimised._showingPIP=!0;const e=document.querySelector(`.${ns}-image-link`);document.body.appendChild(e),e.classList.add(ns+"-pip"),e.style.bottom=Player.position.getHeaderOffset().bottom+10+"px",e.addEventListener("click",Player.show)},hidePIP:function(){Player.minimised._showingPIP=!1;const e=document.querySelector(`.${ns}-image-link`);Player.$(`.${ns}-media`).insertBefore(document.querySelector(`.${ns}-image-link`),Player.$(`.${ns}-controls`)),e.classList.remove(ns+"-pip"),e.style.bottom=null,e.removeEventListener("click",Player.show)}}},function(e,t,n){const{parseFiles:a,parseFileName:s}=n(1);e.exports={atRoot:["add","remove"],delegatedEvents:{click:{[`.${ns}-list-item`]:"playlist.handleSelect"},mousemove:{[`.${ns}-list-item`]:"playlist.positionHoverImage"},dragstart:{[`.${ns}-list-item`]:"playlist.handleDragStart"},dragenter:{[`.${ns}-list-item`]:"playlist.handleDragEnter"},dragend:{[`.${ns}-list-item`]:"playlist.handleDragEnd"},dragover:{[`.${ns}-list-item`]:e=>e.preventDefault()},drop:{[`.${ns}-list-item`]:e=>e.preventDefault()},keyup:{[`.${ns}-playlist-search`]:"playlist._handleSearch"}},undelegatedEvents:{mouseenter:{[`.${ns}-list-item`]:"playlist.updateHoverImage"},mouseleave:{[`.${ns}-list-item`]:"playlist.removeHoverImage"}},initialize:function(){Player.playlist._lastView="playlist"===Player.config.viewStyle||"image"===Player.config.viewStyle?Player.config.viewStyle:"playlist",Player.on("view",e=>{"playlist"===e&&Player.playlist.scrollToPlaying(),"playlist"!==e&&"image"!==e||(Player.playlist._lastView=e)}),Player.on("rendered",()=>Player.playlist.hoverImage=Player.$(`.${ns}-hover-image`)),Player.on("playsound",e=>{Player.playlist.showImage(e),Player.$all(`.${ns}-list-item.playing`).forEach(e=>e.classList.remove("playing")),Player.$(`.${ns}-list-item[data-id="${Player.playing.id}"]`).classList.add("playing"),Player.playlist.scrollToPlaying("nearest")}),Player.on("config:filters",Player.playlist.applyFilters),Player.on("config:hoverImages",Player.playlist.setHoverImageVisibility),Player.on("menu-open",Player.playlist.setHoverImageVisibility),Player.on("menu-close",Player.playlist.setHoverImageVisibility),Player.on("config:showPlaylistSearch",Player.playlist.toggleSearch),Player.userTemplate.maintain(Player.playlist,"rowTemplate",["shuffle"])},render:function(){if(!Player.container)return;Player.$(`.${ns}-list-container`).innerHTML=Player.templates.list(),Player.events.addUndelegatedListeners(document.body,Player.playlist.undelegatedEvents),Player.playlist.hoverImage=Player.$(`.${ns}-hover-image`)},restore:function(){Player.display.setViewStyle(Player.playlist._lastView||"playlist")},showImage:function(e,t){if(!Player.container)return;let n=Player.playlist.isVideo=!t&&(e.image.endsWith(".webm")||"video/webm"===e.type);const a=document.querySelector(`.${ns}-image-link`),s=a.querySelector(`.${ns}-image`),r=a.querySelector(`.${ns}-video`);s.src="",s.src=n||t?e.thumb:e.image,r.src=n?e.image:void 0,"fullscreen"!==Player.config.viewStyle&&(a.href=e.image),a.classList[n?"add":"remove"](ns+"-show-video")},toggleView:function(e){if(!Player.container)return;e&&e.preventDefault();let t="playlist"===Player.config.viewStyle?"image":"playlist";Player.display.setViewStyle(t)},add:function(e,t){try{const n=e.id;if(Player.sounds.find(e=>e.id===n))return;let a=Player.config.shuffle?Math.floor(Math.random()*Player.sounds.length-1):Player.sounds.findIndex(e=>Player.compareIds(e.id,n)>1);if(a<0&&(a=Player.sounds.length),Player.sounds.splice(a,0,e),Player.container){if(!t){const t=Player.$(`.${ns}-list-container`);let n=document.createElement("div");n.innerHTML=Player.templates.list({sounds:[e]}),Player.events.addUndelegatedListeners(n,Player.playlist.undelegatedEvents);let s=n.children[0];if(a<Player.sounds.length-1){const e=Player.$(`.${ns}-list-item[data-id="${Player.sounds[a+1].id}"]`);t.insertBefore(s,e)}else t.appendChild(s)}1===Player.sounds.length&&(/\/thread\//.test(location.href)&&Player.config.autoshow&&Player.show(),Player.playlist.showImage(e)),Player.trigger("add",e)}}catch(t){Player.logError("There was an error adding to the sound player. Please check the console for details.",t),console.log("[4chan sounds player]",e)}},addFromFiles:function(e){[...e].forEach(e=>{if(!e.type.startsWith("image")&&"video/webm"!==e.type)return;const t=URL.createObjectURL(e),n=e.type;let a=t;if("video/webm"!==e.type)return i();const r=document.createElement("canvas"),o=document.createElement("video"),l=r.getContext("2d");function i(){s(e.name,t,null,a,null,!0).forEach(e=>Player.add({...e,local:!0,type:n}))}o.addEventListener("loadeddata",(function(){l.drawImage(o,0,0),a=r.toDataURL(),i()})),o.src=t})},remove:function(e){const t=Player.sounds.indexOf(e);Player.playing===e&&(Player.pause(),Player.next({force:!0})),t>-1&&Player.sounds.splice(t,1),Player.$(`.${ns}-list-container`).removeChild(Player.$(`.${ns}-list-item[data-id="${e.id}"]`)),Player.trigger("remove",e)},handleSelect:function(e){if("A"===e.target.nodeName||e.target.closest("a"))return;e.preventDefault();const t=e.eventTarget.getAttribute("data-id"),n=t&&Player.sounds.find(e=>e.id===t);n&&Player.play(n)},refresh:function(){a(document.body)},toggleHoverImages:function(e){e&&e.preventDefault(),Player.set("hoverImages",!Player.config.hoverImages)},setHoverImageVisibility:function(){const e=Player.$(`.${ns}-player`),t=!Player.config.hoverImages||Player.playlist._dragging||e.querySelector(`.${ns}-menu`);e.classList[t?"add":"remove"](ns+"-hide-hover-image")},updateHoverImage:function(e){const t=e.currentTarget.getAttribute("data-id"),n=Player.sounds.find(e=>e.id===t);Player.playlist.hoverImage.style.display="block",Player.playlist.hoverImage.setAttribute("src",n.thumb),Player.playlist.positionHoverImage(e)},positionHoverImage:function(e){const{width:t,height:n}=Player.playlist.hoverImage.getBoundingClientRect(),a=document.documentElement.clientWidth-t-5;Player.playlist.hoverImage.style.left=Math.min(e.clientX,a)+5+"px",Player.playlist.hoverImage.style.top=e.clientY-n-10+"px"},removeHoverImage:function(){Player.playlist.hoverImage.style.display="none"},handleDragStart:function(e){Player.playlist._dragging=e.eventTarget,Player.playlist.setHoverImageVisibility(),e.eventTarget.classList.add(ns+"-dragging"),e.dataTransfer.setDragImage(new Image,0,0),e.dataTransfer.dropEffect="move",e.dataTransfer.setData("text/plain",e.eventTarget.getAttribute("data-id"))},handleDragEnter:function(e){if(!Player.playlist._dragging)return;e.preventDefault();const t=Player.playlist._dragging,n=t.getAttribute("data-id");let a=e.target.closest&&e.target.closest(`.${ns}-list-item`);if(!a||t===a)return;const s=Player.sounds.findIndex(e=>e.id===n),r=t.parentNode;if(4&t.compareDocumentPosition(a)&&(a=a.nextSibling),a){const e=a.getAttribute("data-id"),n=Player.sounds.findIndex(t=>t.id===e),o=s<n?n-1:n;r.insertBefore(t,a),Player.sounds.splice(o,0,Player.sounds.splice(s,1)[0])}else Player.sounds.push(Player.sounds.splice(s,1)[0]),r.appendChild(t);Player.trigger("order")},handleDragEnd:function(e){Player.playlist._dragging&&(e.preventDefault(),delete Player.playlist._dragging,e.eventTarget.classList.remove(ns+"-dragging"),Player.playlist.setHoverImageVisibility())},scrollToPlaying:function(e="center"){if(Player.$(`.${ns}-list-container .${ns}-menu`))return;const t=Player.$(`.${ns}-list-item.playing`);t&&t.scrollIntoView({block:e})},applyFilters:function(){Player.sounds.filter(e=>!Player.acceptedSound(e)).forEach(Player.playlist.remove)},_handleSearch:function(e){Player.playlist.search(e.eventTarget.value.toLowerCase())},search:function(e){const t=Player.playlist._lastSearch;if(Player.playlist._lastSearch=e,e!==t)return e?void Player.sounds.forEach(e=>{const t=Player.$(`.${ns}-list-item[data-id="${e.id}"]`);t&&(t.style.display=Player.playlist.matchesSearch(e)?null:"none")}):Player.$all(`.${ns}-list-item`).forEach(e=>e.style.display=null)},matchesSearch:function(e){const t=Player.playlist._lastSearch;return!t||e.title.toLowerCase().includes(t)||String(e.post.toLowerCase()).includes(t)||String(e.src.toLowerCase()).includes(t)},toggleSearch:function(e){const t=Player.$(`.${ns}-playlist-search`);!e&&Player.playlist._lastSearch&&Player.playlist.search(),t.style.display=e?null:"none",e&&t.focus()}}},function(e,t){e.exports={delegatedEvents:{mousedown:{[`.${ns}-header`]:"position.initMove",[`.${ns}-expander`]:"position.initResize"}},initialize:function(){Player.on("show",(async function(){const[e,t]=(await GM.getValue("position")||"").split(":"),[n,a]=(await GM.getValue("size")||"").split(":");+e&&+t&&Player.position.move(e,t,!0),+n&&+a&&Player.position.resize(n,a),Player.config.limitPostWidths&&(Player.position.setPostWidths(),window.addEventListener("scroll",Player.position.setPostWidths))})),Player.on("hide",(function(){Player.position.setPostWidths(),window.removeEventListener("scroll",Player.position.setPostWidths)})),Player.on("config",e=>{"limitPostWidths"!==e&&"minPostWidth"!==e||(window.removeEventListener("scroll",Player.position.setPostWidths),Player.position.setPostWidths(),Player.config.limitPostWidths&&window.addEventListener("scroll",Player.position.setPostWidths))}),new MutationObserver((function(){document.querySelectorAll("#hoverUI .postContainer, .inline .postContainer, .backlink_container article").forEach(e=>{e.style.maxWidth=null,e.style.minWidth=null})})).observe(document.body,{childList:!0,subtree:!0}),Player.syncTab("position",e=>Player.position.move(...e.split(":").concat(!0))),Player.syncTab("size",e=>Player.position.resize(...e.split(":")))},setPostWidths:function(){const e=document.documentElement.clientWidth-Player.container.offsetLeft+10,t=is4chan?".thread > .postContainer":".posts > article.post",n=!Player.isHidden&&Player.config.limitPostWidths,a=Player.container.offsetTop,s=Player.container.getBoundingClientRect().height+a;document.querySelectorAll(t).forEach(t=>{const r=n&&t.getBoundingClientRect(),o=n&&r.top+r.height>a&&r.top<s;t.style.maxWidth=o?`calc(100% - ${e}px)`:null,t.style.minWidth=o&&Player.config.minPostWidth?""+Player.config.minPostWidth:null})},initResize:function(e){e.preventDefault(),Player._startX=e.clientX,Player._startY=e.clientY;let{width:t,height:n}=Player.container.getBoundingClientRect();Player._startWidth=t,Player._startHeight=n,document.documentElement.addEventListener("mousemove",Player.position.doResize,!1),document.documentElement.addEventListener("mouseup",Player.position.stopResize,!1)},doResize:function(e){e.preventDefault(),Player.position.resize(Player._startWidth+e.clientX-Player._startX,Player._startHeight+e.clientY-Player._startY)},stopResize:function(){const{width:e,height:t}=Player.container.getBoundingClientRect();document.documentElement.removeEventListener("mousemove",Player.position.doResize,!1),document.documentElement.removeEventListener("mouseup",Player.position.stopResize,!1),GM.setValue("size",e+":"+t)},resize:function(e,t){if(!Player.container||"fullscreen"===Player.config.viewStyle)return;const{bottom:n}=Player.position.getHeaderOffset();t=Math.min(t,document.documentElement.clientHeight-Player.container.offsetTop-n),e=Math.min(e-2,document.documentElement.clientWidth-Player.container.offsetLeft),Player.container.style.width=e+"px";const a="playlist"===Player.config.viewStyle?Player.$(`.${ns}-list-container`):"image"===Player.config.viewStyle?Player.$(`.${ns}-image-link`):"settings"===Player.config.viewStyle?Player.$(`.${ns}-settings`):"threads"===Player.config.viewStyle?Player.$(`.${ns}-threads`):"tools"===Player.config.viewStyle?Player.$(`.${ns}-tools`):null;if(!a)return;const s=Player.container.getBoundingClientRect().height-a.getBoundingClientRect().height;a.style.height=t-s+"px"},initMove:function(e){e.preventDefault(),Player.$(`.${ns}-header`).style.cursor="grabbing";const{width:t,height:n}=Player.container.getBoundingClientRect();Player.position.resize(t,n),Player._offsetX=e.clientX-Player.container.offsetLeft,Player._offsetY=e.clientY-Player.container.offsetTop,document.documentElement.addEventListener("mousemove",Player.position.doMove,!1),document.documentElement.addEventListener("mouseup",Player.position.stopMove,!1)},doMove:function(e){e.preventDefault(),Player.position.move(e.clientX-Player._offsetX,e.clientY-Player._offsetY)},stopMove:function(){document.documentElement.removeEventListener("mousemove",Player.position.doMove,!1),document.documentElement.removeEventListener("mouseup",Player.position.stopMove,!1),Player.$(`.${ns}-header`).style.cursor=null,GM.setValue("position",parseInt(Player.container.style.left,10)+":"+parseInt(Player.container.style.top,10))},move:function(e,t,n){if(!Player.container)return;const{top:a,bottom:s}=Player.position.getHeaderOffset(),{width:r,height:o}=Player.container.getBoundingClientRect(),l=n?1/0:document.documentElement.clientWidth-r,i=n?1/0:document.documentElement.clientHeight-o-s;Player.container.style.left=Math.max(0,Math.min(e,l))+"px",Player.container.style.top=Math.max(a,Math.min(t,i))+"px",Player.config.limitPostWidths&&Player.position.setPostWidths()},getHeaderOffset:function(){const e=document.documentElement.classList,t=e.contains("fixed"),n=t?document.querySelector("#header-bar").getBoundingClientRect().height:0;return{top:t&&e.contains("top-header")?n:0,bottom:t&&e.contains("bottom-header")?n:0}}}},function(e,t,n){const{parseFileName:a}=n(1),{get:s}=n(21);e.exports={boardList:null,soundThreads:null,displayThreads:{},selectedBoards:Board?[Board]:["a"],showAllBoards:!1,delegatedEvents:{click:{[`.${ns}-fetch-threads-link`]:"threads.fetch",[`.${ns}-all-boards-link`]:"threads.toggleBoardList"},keyup:{[`.${ns}-threads-filter`]:e=>Player.threads.filter(e.eventTarget.value)},change:{[`.${ns}-threads input[type=checkbox]`]:"threads.toggleBoard"}},initialize:async function(){Player.threads.hasParser=is4chan&&"undefined"!=typeof Parser,Player.threads.hasParser&&!Parser.customSpoiler&&(Parser.customSpoiler={}),Player.on("show",Player.threads._initialFetch),Player.on("view",Player.threads._initialFetch),Player.on("rendered",Player.threads.afterRender),Player.on("config:threadsViewStyle",Player.threads.render);try{const e=await GM.getValue("threads_board_selection");e&&(Player.threads.selectedBoards=e.split(","))}catch(e){}},_initialFetch:function(){Player.container&&"threads"===Player.config.viewStyle&&null===Player.threads.boardList&&Player.threads.fetchBoards(!0)},render:function(){Player.container&&(Player.$(`.${ns}-threads`).innerHTML=Player.templates.threads(),Player.threads.afterRender())},afterRender:function(){const e=Player.$(`.${ns}-thread-list`);if(e){const t=document.defaultView.getComputedStyle(document.body);e.style.background=t.backgroundColor,e.style.backgroundImage=t.backgroundImage,e.style.backgroundRepeat=t.backgroundRepeat,e.style.backgroundPosition=t.backgroundPosition}Player.threads.renderThreads()},renderThreads:function(){if(Player.threads.hasParser&&"table"!==Player.config.threadsViewStyle)try{const e=Player.$(`.${ns}-thread-list`);for(let t in Player.threads.displayThreads){const n=Player.threads.boardList.find(e=>e.board===t),a=`/${n.board}/ - ${n.title}`;createElement(`<div class="boardBanner"><div class="boardTitle">${a}</div></div>`,e);const s=Player.threads.displayThreads[t];for(let t=0;t<s.length;t++)e.appendChild(Parser.buildHTMLFromJSON.call(Parser,s[t],s[t].board,!0,!0)),createElement('<hr style="clear: both">',e)}}catch(e){Player.logError("Unable to display the threads board view.",e,"warning"),Player.set("threadsViewStyle","table"),Player.renderThreads()}else Player.$(`.${ns}-threads-body`).innerHTML=Player.templates.threadList()},renderBoards:function(){Player.$(`.${ns}-thread-board-list`).innerHTML=Player.templates.threadBoards()},toggle:function(e){e&&e.preventDefault(),"threads"===Player.config.viewStyle?Player.playlist.restore():Player.display.setViewStyle("threads")},toggleBoardList:function(e){e.preventDefault(),Player.threads.showAllBoards=!Player.threads.showAllBoards,Player.$(`.${ns}-all-boards-link`).innerHTML=Player.threads.showAllBoards?"Selected Only":"Show All",Player.threads.renderBoards()},toggleBoard:async function(e){const t=e.eventTarget.value;e.eventTarget.checked?!Player.threads.selectedBoards.includes(t)&&Player.threads.selectedBoards.unshift(t):Player.threads.selectedBoards=Player.threads.selectedBoards.filter(e=>e!==t),await GM.setValue("threads_board_selection",Player.threads.selectedBoards.slice(0,10).join(","))},fetchBoards:async function(e){Player.threads.loading=!0,Player.threads.render(),Player.threads.boardList=(await s("https://a.4cdn.org/boards.json")).boards,e?Player.threads.fetch():(Player.threads.loading=!1,Player.threads.render())},fetch:async function(e){if(e&&e.preventDefault(),Player.threads.loading=!0,Player.threads.render(),!Player.threads.boardList)try{await Player.threads.fetchBoards()}catch(e){return Player.logError("Failed fetching the boards list.",e)}const t=[];try{await Promise.all(Player.threads.selectedBoards.map(async e=>{const n=Player.threads.boardList.find(t=>t.board===e);if(!n)return;(n&&await s("https://a.4cdn.org/%s/catalog.json".replace("%s",e))||[]).forEach(({page:a,threads:s})=>{t.push(...s.map(t=>Object.assign(t,{board:e,page:a,ws_board:n.ws_board})))})})),Player.threads.soundThreads=t.filter(e=>a(e.filename,`https://i.4cdn.org/${e.board}/${e.tim}${e.ext}`,e.no,`https://i.4cdn.org/${e.board}/${e.tim}s${e.ext}`,e.md5,!0).length)}catch(e){Player.logError("Failed searching for sounds threads.",e)}Player.threads.loading=!1,Player.threads.filter(Player.$(`.${ns}-threads-filter`).value,!0),Player.threads.render()},filter:function(e,t){Player.threads.filterValue=e||"",null!==Player.threads.soundThreads&&(Player.threads.displayThreads=Player.threads.soundThreads.reduce((t,n)=>((!e||n.sub&&n.sub.includes(e)||n.com&&n.com.includes(e))&&(t[n.board]||(t[n.board]=[]),t[n.board].push(n)),t),{}),!t&&Player.threads.renderThreads())}}},function(e,t){const n={};e.exports={get:async function(e){return new Promise((function(t,a){const s={};n[e]&&(s["If-Modified-Since"]=n[e].lastModified),GM.xmlHttpRequest({method:"GET",url:e,headers:s,responseType:"json",onload:a=>{a.status>=200&&a.status<300&&(n[e]={lastModified:a.responseHeaders["last-modified"],response:a.response}),t(304===a.status?n[e].response:a.response)},onerror:a})}))}}},function(e,t){e.exports={hasFFmpeg:"function"==typeof ffmpeg,createStatusText:"",delegatedEvents:{click:{[`.${ns}-create-button`]:"tools._handleCreate",[`.${ns}-create-sound-post-link`]:"tools._addCreatedToQR",[`.${ns}-create-sound-add-link`]:"tools._addCreatedToPlayer",[`.${ns}-toggle-sound-input`]:"tools._handleToggleSoundInput"},change:{[`.${ns}-create-sound-img`]:"tools._handleImageSelect",[`.${ns}-create-sound-form input[type=file]`]:e=>Player.tools._handleFileSelect(e.eventTarget),[`.${ns}-use-video`]:"tools._handleWebmSoundChange"},drop:{[`.${ns}-create-sound-form`]:"tools._handleCreateSoundDrop"},keyup:{[`.${ns}-encoded-input`]:"tools._handleEncoded",[`.${ns}-decoded-input`]:"tools._handleDecoded"}},initialize:function(){Player.on("config:uploadHosts",Player.tools.render),Player.on("config:defaultUploadHost",e=>Player.$(`.${ns}-create-sound-host`).value=e),Player.on("rendered",Player.tools.afterRender)},render:function(){Player.$(`.${ns}-tools`).innerHTML=Player.templates.tools(),Player.tools.afterRender()},afterRender:function(){Player.tools.status=Player.$(`.${ns}-create-sound-status`),Player.tools.imgInput=Player.$(`.${ns}-create-sound-img`),Player.tools.sndInput=Player.$(`.${ns}-create-sound-snd`)},toggle:function(e){e&&e.preventDefault(),"tools"===Player.config.viewStyle?Player.playlist.restore():Player.display.setViewStyle("tools")},updateCreateStatus:function(e){Player.tools.status.style.display=e?"inherit":"none",Player.tools.status.innerHTML=Player.tools.createStatusText=e},_handleDecoded:function(e){Player.$(`.${ns}-encoded-input`).value=encodeURIComponent(e.eventTarget.value)},_handleEncoded:function(e){Player.$(`.${ns}-decoded-input`).value=decodeURIComponent(e.eventTarget.value)},_handleImageSelect:async function(e){const t=(e&&e.eventTarget||Player.tools.imgInput).files[0],n="video/webm"===t.type;let a=t.name.replace(/\.[^/.]+$/,"");if(Player.tools.hasFFmpeg){Player.$(`.${ns}-use-video-label`).style.display=n?"inherit":"none";const e=Player.$(`.${ns}-use-video`);e.checked&&n&&Player.tools._handleFileSelect(Player.tools.sndInput,t),e.checked&&!n&&e.click()}else await Player.tools.hasAudio(t)&&Player.logError("Audio not allowed for the image webm.",null,"warning");Player.$(`.${ns}-create-sound-name`).setAttribute("placeholder",a)},_handleFileSelect:function(e,t){const n=e.parentNode,a=n.querySelector("span");t||(t=e.files[0]),n.classList[t?"remove":"add"]("placeholder"),a.innerHTML=t?t.name:n.getAttribute("placeholder")},_handleWebmSoundChange:function(e){const t=Player.tools.sndInput,n=Player.tools.imgInput;Player.tools._handleFileSelect(t,e.eventTarget.checked&&n.files[0])},_handleToggleSoundInput:function(e){e.preventDefault();const t="url"===e.eventTarget.getAttribute("data-type");Player.$(`.${ns}-create-sound-snd-url`).closest(`.${ns}-row`).style.display=t?null:"none",Player.$(`.${ns}-create-sound-snd`).closest(`.${ns}-file-overlay`).style.display=t?"none":null,Player.tools.useSoundURL=t},_handleCreateSoundDrop:function(e){e.preventDefault(),e.stopPropagation();const t="INPUT"===e.target.nodeName&&"file"===e.target.getAttribute("type")&&e.target;return[...e.dataTransfer.files].forEach(e=>{const n=e.type.startsWith("video"),a=e.type.startsWith("image")||"video/webm"===e.type,s=e.type.startsWith("audio");if(n||a||s){const n=new DataTransfer;n.items.add(e);const s="video/webm"===e.type&&t?t:a?Player.tools.imgInput:Player.tools.sndInput;s.files=n.files,Player.tools._handleFileSelect(s,e),s===Player.tools.imgInput&&Player.tools._handleImageSelect()}}),!1},_handleCreate:async function(e){e&&e.preventDefault(),Player.tools._createdImageURL&&URL.revokeObjectURL(Player.tools._createdImageURL),Player.tools._createdImage=null,Player.tools.updateCreateStatus("Creating sound image"),Player.$(`.${ns}-create-button`).disabled=!0;const t=Player.$(`.${ns}-create-sound-host`).value,n=Player.tools.useSoundURL;let a=Player.tools.imgInput.files[0],s=n&&Player.$(`.${ns}-create-sound-snd-url`).value,r=(Player.$(`.${ns}-use-video`)||{}).checked&&a.type.startsWith("video")?a:Player.tools.sndInput.files[0];const o=Player.$(`.${ns}-create-sound-name`).value||a&&a.name.replace(/\.[^/.]+$/,""),l=a&&a.type.startsWith("video")&&await Player.tools.hasAudio(a);try{if(!a)throw new PlayerError("Select an image or webm.","warning");if(l){if(!Player.tools.hasFFmpeg)throw Player.tools.updateCreateStatus(Player.tools.createStatusText+"<br>Audio not allowed for the image webm.<br>Remove the audio from the webm and try again."),new PlayerError("Audio not allowed for the image webm.","warning");a=await Player.tools.extract(a,"video")}if(n)try{new URL(s)}catch(e){throw new PlayerError("The provided sound URL is invalid.","warning")}else{if(!r)throw new PlayerError("Select a sound.","warning");if(r.type.startsWith("video")){if(!await Player.tools.hasAudio(r))throw new PlayerError("The selected video has no audio.","warning");Player.tools.hasFFmpeg||(r=await Player.tools.extract(r,"audio"))}try{s=await Player.tools.postFile(r,t)}catch(e){throw new PlayerError("Upload failed.","error",e)}}const e=a.name.match(/\.([^/.]+)$/)[1],i=new File([a],`${o}[sound=${encodeURIComponent(s)}].${e}`,{type:a.type});Player.tools._createdImage=i,Player.tools._createdImageURL=URL.createObjectURL(i),Player.tools.updateCreateStatus(Player.tools.createStatusText+"<br>Complete!<br>"+(is4chan?`<a href="#" class="${ns}-create-sound-post-link">Post</a> - `:"")+` <a href="#" class="${ns}-create-sound-add-link">Add</a> - `+` <a href="${Player.tools._createdImageURL}" download="${Player.tools._createdImage.name}">Download</a>`)}catch(e){Player.tools.updateCreateStatus(Player.tools.createStatusText+"<br>Failed!"),Player.logError("Failed to create sound image",e)}Player.$(`.${ns}-create-button`).disabled=!1},hasAudio:function(e){return!(!e.type.startsWith("audio")&&!e.type.startsWith("video"))&&new Promise((t,n)=>{const a=URL.createObjectURL(e),s=document.createElement("video");s.addEventListener("loadeddata",()=>{URL.revokeObjectURL(a),t(s.mozHasAudio||!!s.webkitAudioDecodedByteCount)}),s.addEventListener("error",n),s.src=a})},extract:async function(e,t){if(Player.tools.updateCreateStatus(Player.tools.createStatusText+"<br>Extracting "+t),"function"!=typeof ffmpeg)return e;const n=e.name.replace(/\.[^/.]+$/,"")+("audio"===t?".ogg":".webm"),a=ffmpeg({MEMFS:[{name:"_"+e.name,data:await new Response(e).arrayBuffer()}],arguments:"audio"===t?["-i","_"+e.name,"-vn","-c","copy",n]:["-i","_"+e.name,"-an","-c","copy",n]});return new File([a.MEMFS[0].data],n,{type:"audio"===t?"audio/ogg":"video/webm"})},postFile:async function(e,t){const n=Player.config.uploadHosts[t];if(!n||n.invalid)throw new PlayerError("Invalid upload host: "+t,"error");const a=new FormData;Object.keys(n.data).forEach(t=>{null!==n.data[t]&&a.append(t,"$file"===n.data[t]?e:n.data[t])});const s=Player.tools.createStatusText;return Player.tools.updateCreateStatus(Player.tools.createStatusText+"<br>Uploading sound"),new Promise((t,r)=>{GM.xmlHttpRequest({method:"POST",url:n.url,data:a,responseType:n.responsePath?"json":"text",headers:n.headers,onload:async e=>{if(e.status<200||e.status>=300)return r(e);const a=n.responsePath?_get(e.response,n.responsePath):n.responseMatch?(e.responseText.match(new RegExp(n.responseMatch))||[])[1]:e.responseText,o=n.soundUrl?n.soundUrl.replace("%s",a):a;Player.tools.updateCreateStatus(s+`<br>Uploaded to <a href="${o}" target="_blank">${o}</a>`),t(o)},upload:{onprogress:t=>{const n=t.total>0?t.total:e.size;Player.tools.updateCreateStatus(s+"<br>Uploading sound - "+Math.floor(t.loaded/n*100)+"%")}},onerror:r})})},_addCreatedToPlayer:function(e){e.preventDefault(),Player.playlist.addFromFiles([Player.tools._createdImage])},_addCreatedToQR:function(e){if(!is4chan)return;e.preventDefault();const t=document.querySelector(isChanX?".qr-link":".open-qr-link"),n=new DataTransfer;if(n.items.add(Player.tools._createdImage),isChanX){t.click();const e=new CustomEvent("drop",{view:window,bubbles:!0,cancelable:!0});e.dataTransfer=n,document.querySelector("#qr").dispatchEvent(e)}else t?(t.click(),document.querySelector("#qrFile").files=n.files):(document.querySelector("#togglePostFormLink a").click(),document.querySelector("#postFile").files=n.files,document.querySelector(".postForm").scrollIntoView())}}},function(e,t,n){const a=n(24),s=/p: ?{([^}]*)}/g,r=/h: ?{([^}]*)}/g,o=new RegExp(`(${a.map(e=>e.tplName).join("|")})-(?:button|link)(?:\\:"([^"]+?)")?`,"g"),l=/sound-name/g,i=/sound-index/g,d=/sound-count/g,c=[];e.exports={buttons:a,delegatedEvents:{click:{[`.${ns}-playing-jump-link`]:()=>Player.playlist.scrollToPlaying("center"),[`.${ns}-viewStyle-button`]:"playlist.toggleView",[`.${ns}-hoverImages-button`]:"playlist.toggleHoverImages",[`.${ns}-remove-link`]:"userTemplate._handleRemove",[`.${ns}-filter-link`]:"userTemplate._handleFilter",[`.${ns}-download-link`]:"userTemplate._handleDownload",[`.${ns}-shuffle-button`]:"userTemplate._handleShuffle",[`.${ns}-repeat-button`]:"userTemplate._handleRepeat",[`.${ns}-reload-button`]:noDefault("playlist.refresh"),[`.${ns}-add-button`]:noDefault(()=>Player.$(`.${ns}-file-input`).click()),[`.${ns}-item-menu-button`]:"userTemplate._handleItemMenu",[`.${ns}-view-menu-button`]:"userTemplate._handleViewsMenu",[`.${ns}-threads-button`]:"threads.toggle",[`.${ns}-tools-button`]:"tools.toggle",[`.${ns}-config-button`]:"settings.toggle",[`.${ns}-player-button`]:"playlist.restore"},change:{[`.${ns}-file-input`]:"userTemplate._handleFileSelect"}},undelegatedEvents:{click:{body:"userTemplate._closeMenus"},keydown:{body:e=>"Escape"===e.key&&Player.userTemplate._closeMenus()}},initialize:function(){Player.on("config",Player.userTemplate._handleConfig),Player.on("playsound",()=>Player.userTemplate._handleEvent("playsound")),Player.on("add",()=>Player.userTemplate._handleEvent("add")),Player.on("remove",()=>Player.userTemplate._handleEvent("remove")),Player.on("order",()=>Player.userTemplate._handleEvent("order")),Player.on("show",()=>Player.userTemplate._handleEvent("show")),Player.on("hide",()=>Player.userTemplate._handleEvent("hide"))},build:function(e){const t=e.outerClass||"",n=e.sound&&e.sound.title||e.defaultName;let c=e.template.replace(s,Player.playing&&Player.playing===e.sound?"$1":"").replace(r,`<span class="${ns}-hover-display ${t}">$1</span>`).replace(o,(function(n,s,r){let o=a.find(e=>e.tplName===s);if(o.requireSound&&!e.sound||o.showIf&&!o.showIf(e))return"";o.values&&(o={...o,...o.values[_get(Player.config,o.property)]||o.values[Object.keys(o.values)[0]]});const l="function"==typeof o.attrs?o.attrs(e):o.attrs||[];return l.some(e=>e.startsWith("href"))||l.push('href="javascript:;"'),(o.class||t)&&l.push(`class="${o.class||""} ${t||""}"`),r||(r=o.icon?`<span class="fa ${o.icon}">${o.text}</span>`:o.text),`<a ${l.join(" ")}>${r}</a>`})).replace(l,n?`<div class="fc-sounds-col fc-sounds-truncate-text"><span title="${n}">${n}</span></div>`:"").replace(i,e.sound?Player.sounds.indexOf(e.sound)+1:0).replace(d,Player.sounds.length).replace(/%v/g,"3.0.0-32b5b39");if(e.replacements)for(let t of Object.keys(e.replacements))c=c.replace(new RegExp(t,"g"),e.replacements[t]);return c},maintain:function(e,t,n=[],a=[]){c.push({component:e,property:t,...Player.userTemplate.findDependencies(t,null),alwaysRenderConfigs:n,alwaysRenderEvents:a})},findDependencies:function(e,t){t||(t=_get(Player.config,e));const n=[],r=d.test(t),c=l.test(t),u=i.test(t),y=s.test(t);r&&n.push("add","remove"),(y||"rowTemplate"!==e&&(c||u))&&n.push("playsound"),u&&n.push("order");const p=[];let h;for(;null!==(h=o.exec(t));)if(!h[2]){let e=h[1],t=a.find(t=>t.tplName===e);t.property&&p.push(t.property)}return{events:n,config:p}},_handleConfig:function(e,t){c.forEach(n=>{n.property===e&&(Object.assign(n,Player.userTemplate.findDependencies(e,t)),n.component.render())}),c.forEach(t=>{(t.alwaysRenderConfigs.includes(e)||t.config.includes(e))&&t.component.render()})},_handleEvent:function(e){c.forEach(t=>{(t.alwaysRenderEvents.includes(e)||t.events.includes(e))&&t.component.render()})},_handleFileSelect:function(e){e.preventDefault();const t=e.eventTarget;Player.playlist.addFromFiles(t.files)},_handleRepeat:function(e){e.preventDefault();const t=["all","one","none"],n=t.indexOf(Player.config.repeat);Player.set("repeat",t[(n+4)%3])},_handleShuffle:function(e){if(e.preventDefault(),Player.set("shuffle",!Player.config.shuffle),Player.header.render(),Player.config.shuffle){const e=Player.sounds;for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}else Player.sounds.sort((e,t)=>Player.compareIds(e.id,t.id));Player.trigger("order")},_handleItemMenu:function(e){e.preventDefault(),e.stopPropagation();const t=e.eventTarget.getAttribute("data-id"),n=Player.sounds.find(e=>e.id===t),a=e.eventTarget.closest(`.${ns}-list-container`)||Player.container,s=createElement(Player.templates.itemMenu({sound:n}),a);Player.userTemplate._showMenu(e.clientX,e.clientY,s,a)},_handleViewsMenu:function(e){e.preventDefault(),e.stopPropagation();const t=createElement(Player.templates.viewsMenu());Player.userTemplate._showMenu(e.clientX,e.clientY,t)},_showMenu:function(e,t,n,a){Player.userTemplate._closeMenus(),n.style.top=t+"px",n.style.left=e+"px",a||(a=Player.container),a.appendChild(n);const s=document.defaultView.getComputedStyle(n),r=parseInt(s.width,10),o=parseInt(s.height,10);e-r>0&&(n.style.left=e-r+"px"),t+o>document.documentElement.clientHeight-40&&(n.style.top=t-o+"px"),n.querySelectorAll(".entry").forEach(e=>{e.addEventListener("mouseenter",Player.userTemplate._setFocusedMenuItem),e.addEventListener("mouseleave",Player.userTemplate._unsetFocusedMenuItem)}),Player.trigger("menu-open",n)},_closeMenus:function(){document.querySelectorAll(`.${ns}-menu`).forEach(e=>{e.parentNode.removeChild(e),Player.trigger("menu-close",e)})},_setFocusedMenuItem:function(e){e.currentTarget.classList.add("focused");const t=e.currentTarget.querySelector(".submenu");t&&t.getBoundingClientRect().right>document.documentElement.clientWidth&&(t.style.inset="0px auto auto -100%")},_unsetFocusedMenuItem:function(e){e.currentTarget.classList.remove("focused")},_handleFilter:function(e){e.preventDefault();let t=e.eventTarget.getAttribute("data-filter");t&&Player.set("filters",Player.config.filters.concat(t))},_handleDownload:function(e){const t=e.eventTarget.getAttribute("data-src"),n=e.eventTarget.getAttribute("data-name")||new URL(t).pathname.split("/").pop();GM.xmlHttpRequest({method:"GET",url:t,responseType:"blob",onload:e=>{const t=createElement(`<a href="${URL.createObjectURL(e.response)}" download="${n}" rel="noopener" target="_blank"></a>`);t.click(),URL.revokeObjectURL(t.href)},onerror:e=>Player.logError("There was an error downloading.",e,"warning")})},_handleRemove:function(e){const t=e.eventTarget.getAttribute("data-id"),n=t&&Player.sounds.find(e=>e.id===""+t);n&&Player.remove(n)}}},function(e,t){e.exports=[{property:"repeat",tplName:"repeat",class:ns+"-repeat-button",values:{all:{attrs:['title="Repeat All"'],text:"[RA]",icon:"fa-repeat"},one:{attrs:['title="Repeat One"'],text:"[R1]",icon:"fa-repeat fa-repeat-one"},none:{attrs:['title="No Repeat"'],text:"[R0]",icon:"fa-repeat disabled"}}},{property:"shuffle",tplName:"shuffle",class:ns+"-shuffle-button",values:{true:{attrs:['title="Shuffled"'],text:"[S]",icon:"fa-random"},false:{attrs:['title="Ordered"'],text:"[O]",icon:"fa-random disabled"}}},{property:"viewStyle",tplName:"playlist",class:ns+"-viewStyle-button",values:{playlist:{attrs:['title="Hide Playlist"'],text:"[+]",icon:"fa-compress"},image:{attrs:['title="Show Playlist"'],text:"[-]",icon:"fa-expand"}}},{property:"hoverImages",tplName:"hover-images",class:ns+"-hoverImages-button",values:{true:{attrs:['title="Hover Images Enabled"'],text:"[H]",icon:"fa-picture-o"},false:{attrs:['title="Hover Images Disabled"'],text:"[-]",icon:"fa-picture-o disabled"}}},{tplName:"add",class:ns+"-add-button",icon:"fa-plus",text:"+",attrs:['title="Add local files"']},{tplName:"reload",class:ns+"-reload-button",icon:"fa-refresh",text:"[R]",attrs:['title="Reload the playlist"']},{tplName:"settings",class:ns+"-config-button",icon:"fa-wrench",text:"[S]",attrs:['title="Settings"']},{tplName:"threads",class:ns+"-threads-button",icon:"fa-search",text:"[T]",attrs:['title="Threads"']},{tplName:"tools",class:ns+"-tools-button",icon:"fa-gears",text:"[T]",attrs:['title="Tools"']},{tplName:"close",class:ns+"-close-button",icon:"fa-times",text:"X",attrs:['title="Hide the player"']},{tplName:"playing",requireSound:!0,class:ns+"-playing-jump-link",text:"Playing",attrs:['title="Scroll the playlist currently playing sound."']},{tplName:"post",requireSound:!0,icon:"fa-comment-o",text:"Post",showIf:e=>e.sound.post,attrs:e=>["href="+("#"+(is4chan?"p":"")+e.sound.post),'title="Jump to the post for the current sound"']},{tplName:"image",requireSound:!0,icon:"fa-image",text:"i",attrs:e=>["href="+e.sound.image,'title="Open the image in a new tab"','target="_blank"']},{tplName:"sound",requireSound:!0,href:e=>e.sound.src,icon:"fa-volume-up",text:"s",attrs:e=>["href="+e.sound.src,'title="Open the sound in a new tab"','target="_blank"']},{tplName:"dl-image",requireSound:!0,class:ns+"-download-link",icon:"fa-file-image-o",text:"i",attrs:e=>['title="Download the image with the original filename"',`data-src="${e.sound.image}"`,`data-name="${e.sound.filename}"`]},{tplName:"dl-sound",requireSound:!0,class:ns+"-download-link",icon:"fa-file-sound-o",text:"s",attrs:e=>['title="Download the sound"',`data-src="${e.sound.src}"`]},{tplName:"filter-image",requireSound:!0,class:ns+"-filter-link",icon:"fa-filter",text:"i",showIf:e=>e.sound.imageMD5,attrs:e=>['title="Add the image MD5 to the filters."',`data-filter="${e.sound.imageMD5}"`]},{tplName:"filter-sound",requireSound:!0,class:ns+"-filter-link",icon:"fa-filter",text:"s",attrs:e=>['title="Add the sound URL to the filters."',`data-filter="${e.sound.src.replace(/^(https?:)?\/\//,"")}"`]},{tplName:"remove",requireSound:!0,class:ns+"-remove-link",icon:"fa-trash-o",text:"r",attrs:e=>['title="Filter the image."',`data-id="${e.sound.id}"`]},{tplName:"menu",requireSound:!0,class:ns+"-item-menu-button",icon:"fa-angle-down",text:"",attrs:e=>["data-id="+e.sound.id]},{tplName:"view-menu",class:ns+"-view-menu-button",icon:"fa-angle-down",text:"",attrs:['href="javascript:;"']}]},function(e,t){e.exports=(e={})=>`<div id="${ns}-container" data-view-style="${Player.config.viewStyle}" style="top: 30px; left: 0px; width: 350px; display: none;">\n\t<div class="${ns}-header ${ns}-row">\n\t\t${Player.templates.header(e)}\n\t</div>\n\t<div class="${ns}-view-container">\n\t\t<div class="${ns}-player ${Player.config.hoverImages?"":ns+"-hide-hover-image"}">\n\t\t\t${Player.templates.player(e)}\n\t\t</div>\n\t\t<div class="${ns}-settings ${ns}-panel" style="height: 400px">\n\t\t\t${Player.templates.settings(e)}\n\t\t</div>\n\t\t<div class="${ns}-threads ${ns}-panel" style="height: 400px">\n\t\t\t${Player.templates.threads(e)}\n\t\t</div>\n\t\t<div class="${ns}-tools ${ns}-panel" style="height: 400px">\n\t\t\t${Player.templates.tools(e)}\n\t\t</div>\n\t</div>\n\t<div class="${ns}-footer">\n\t\t${Player.templates.footer(e)}\n\t</div>\n\t<input class="${ns}-file-input" type="file" style="display: none" accept="image/*,.webm" multiple>\n</div>`},function(e,t){e.exports=(e={})=>`<div class="${ns}-col-auto ${ns}-col-auto">\n\t<div class="${ns}-media-control ${ns}-previous-button">\n\t\t<div class="${ns}-previous-button-display"></div>\n\t</div>\n\t<div class="${ns}-media-control ${ns}-play-button">\n\t\t<div class="${ns}-play-button-display ${!Player.audio||Player.audio.paused?ns+"-play":""}"></div>\n\t</div>\n\t<div class="${ns}-media-control ${ns}-next-button">\n\t\t<div class="${ns}-next-button-display"></div>\n\t</div>\n</div>\n<div class="${ns}-col">\n\t<div class="${ns}-seek-bar ${ns}-progress-bar">\n\t\t<div class="${ns}-full-bar">\n\t\t\t<div class="${ns}-loaded-bar"></div>\n\t\t\t<div class="${ns}-current-bar"></div>\n\t\t</div>\n\t</div>\n</div>\n<div class="${ns}-col-auto">\n\t<span class="${ns}-current-time">0:00</span> / <span class="${ns}-duration">0:00</span>\n</div>\n<div class="${ns}-col-auto">\n\t<div class="${ns}-volume-bar ${ns}-progress-bar">\n\t\t<div class="${ns}-full-bar">\n\t\t\t<div class="${ns}-current-bar" style="width: ${100*Player.audio.volume}%"></div>\n\t\t</div>\n\t</div>\n</div>\n<div class="${ns}-col-auto">\n\t<div class="${ns}-media-control ${ns}-fullscreen-button">\n\t\t<div class="${ns}-fullscreen-button-display"></div>\n\t</div>\n</div>`},function(e,t){e.exports=(e={})=>`.${ns}-controls{align-items:center;padding:.5rem;background:#3f3f44}.${ns}-media-control{height:1.5rem;width:1.5rem;display:flex;justify-content:center;align-items:center;cursor:pointer}.${ns}-media-control>div{height:1rem;width:.8rem;background:#fff}.${ns}-media-control:hover>div{background:#00b6f0}.${ns}-play-button-display{clip-path:polygon(10% 10%, 10% 90%, 35% 90%, 35% 10%, 65% 10%, 65% 90%, 90% 90%, 90% 10%, 10% 10%)}.${ns}-play-button-display.${ns}-play{clip-path:polygon(0 0, 0 100%, 100% 50%, 0 0)}.${ns}-previous-button-display,.${ns}-next-button-display{clip-path:polygon(10% 10%, 10% 90%, 30% 90%, 30% 50%, 90% 90%, 90% 10%, 30% 50%, 30% 10%, 10% 10%)}.${ns}-next-button-display{transform:scale(-1, 1)}.${ns}-fullscreen-button-display{width:1rem !important;clip-path:polygon(0% 35%, 0% 0%, 35% 0%, 35% 15%, 15% 15%, 15% 35%, 0% 35%, 0% 100%, 35% 100%, 35% 85%, 15% 85%, 15% 65%, 0% 65%, 100% 65%, 100% 100%, 65% 100%, 65% 85%, 85% 85%, 85% 15%, 65% 15%, 65% 0%, 100% 0%, 100% 35%, 85% 35%, 85% 65%, 0% 65%)}.${ns}-controls .${ns}-current-time{color:#fff}.${ns}-duration{color:#909090}.${ns}-progress-bar{min-width:3.5rem;height:1.5rem;display:flex;align-items:center;margin:0 1rem}.${ns}-progress-bar .${ns}-full-bar{height:.3rem;width:100%;background:#131314;border-radius:1rem;position:relative}.${ns}-progress-bar .${ns}-full-bar>div{position:absolute;top:0;bottom:0;border-radius:1rem}.${ns}-progress-bar .${ns}-full-bar .${ns}-loaded-bar{background:#5a5a5b}.${ns}-progress-bar .${ns}-full-bar .${ns}-current-bar{display:flex;justify-content:flex-end;align-items:center}.${ns}-progress-bar .${ns}-full-bar .${ns}-current-bar:after{content:"";background:#fff;height:.8rem;min-width:.8rem;border-radius:1rem;box-shadow:rgba(0,0,0,.76) 0 0 3px 0}.${ns}-progress-bar:hover .${ns}-current-bar:after{background:#00b6f0}.${ns}-seek-bar .${ns}-current-bar{background:#00b6f0}.${ns}-volume-bar .${ns}-current-bar{background:#fff}.${ns}-chan-x-controls{align-items:inherit}.${ns}-chan-x-controls .${ns}-current-time,.${ns}-chan-x-controls .${ns}-duration{margin:0 .25rem}.${ns}-chan-x-controls .${ns}-media-control{width:1rem;height:auto;margin-top:-1px}.${ns}-chan-x-controls .${ns}-media-control>div{height:.7rem;width:.5rem}.${ns}-footer{padding:.15rem .25rem;border-top:solid 1px ${Player.config.colors.border}}.${ns}-footer .${ns}-expander{position:absolute;bottom:0px;right:0px;height:.75rem;width:.75rem;cursor:se-resize;background:linear-gradient(to bottom right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0) 50%, ${Player.config.colors.border} 55%, ${Player.config.colors.border} 100%)}.${ns}-footer:hover .${ns}-hover-display{display:inline-block}.${ns}-header{cursor:grab;text-align:center;border-bottom:solid 1px ${Player.config.colors.border};padding:.25rem .125rem}.${ns}-header:hover .${ns}-hover-display{display:flex}html:not(.fourchan-x) .${ns}-header .${ns}-col-auto{margin:0 .075rem}html.fourchan-x .fa-repeat.fa-repeat-one::after{content:"1";font-size:.5rem;visibility:visible;margin-left:-1px}.${ns}-image-link{text-align:center;display:flex;justify-items:center;justify-content:center}.${ns}-image-link.${ns}-pip{position:fixed;right:10px;height:${Player.config.maxPIPWidth} !important;max-width:${Player.config.maxPIPWidth};align-items:end}.${ns}-image-link.${ns}-pip .${ns}-image,.${ns}-image-link.${ns}-pip .${ns}-video{max-height:100%;height:initial;width:initial;object-fit:contain}.${ns}-image-link .${ns}-video{display:none}.${ns}-image,.${ns}-video{height:100%;width:100%;object-fit:contain}.${ns}-image-link.${ns}-show-video .${ns}-video{display:block}.${ns}-image-link.${ns}-show-video .${ns}-image{display:none}#${ns}-container{position:fixed;background:${Player.config.colors.background};border:1px solid ${Player.config.colors.border};min-width:100px;color:${Player.config.colors.text}}.${ns}-panel{padding:0 .25rem;height:100%;width:calc(100% - .5rem);overflow:auto}.${ns}-heading{font-weight:600;margin:.5rem 0;min-width:100%}.${ns}-has-description{cursor:help}.${ns}-heading-action{font-weight:normal;text-decoration:underline;margin-left:.25rem}.${ns}-row{display:flex;flex-wrap:wrap;min-width:100%;box-sizing:border-box}.${ns}-col-auto{flex:0 0 auto;width:auto;max-width:100%;display:inline-flex}.${ns}-col{flex-basis:0;flex-grow:1;max-width:100%;width:100%}html.fourchan-x #${ns}-container .fa{font-size:0;visibility:hidden;margin:0 .15rem}.${ns}-truncate-text{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.${ns}-hover-display{display:none}html:not(.fourchan-x) .dialog{background:${Player.config.colors.background};background:${Player.config.colors.background};border-color:${Player.config.colors.border};border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.15);border-radius:3px;padding-top:1px;padding-bottom:3px}html:not(.fourchan-x) .${ns}-menu .entry{position:relative;display:block;padding:.125rem .5rem;min-width:70px;white-space:nowrap}html:not(.fourchan-x) .${ns}-menu .has-submenu::after{content:"";border-left:.5em solid;border-top:.3em solid transparent;border-bottom:.3em solid transparent;display:inline-block;margin:.35em;position:absolute;right:3px}html:not(.fourchan-x) .${ns}-menu .submenu{position:absolute;display:none}html:not(.fourchan-x) .${ns}-menu .focused>.submenu{display:block}.${ns}-player .${ns}-hover-image{position:fixed;max-height:125px;max-width:125px}.${ns}-player.${ns}-hide-hover-image .${ns}-hover-image{display:none !important}.${ns}-list-container{overflow-y:auto}.${ns}-list-container .${ns}-list-item{list-style-type:none;padding:.15rem .25rem;white-space:nowrap;text-overflow:ellipsis;cursor:pointer;background:${Player.config.colors.odd_row};overflow:hidden;height:1.3rem}.${ns}-list-container .${ns}-list-item.playing{background:${Player.config.colors.playing} !important}.${ns}-list-container .${ns}-list-item:nth-child(2n){background:${Player.config.colors.even_row}}.${ns}-list-container .${ns}-list-item .${ns}-item-menu-button{right:.25rem}.${ns}-list-container .${ns}-list-item:hover .${ns}-hover-display{display:flex}.${ns}-list-container .${ns}-list-item.${ns}-dragging{background:${Player.config.colors.dragging}}.${ns}-settings textarea{border:solid 1px ${Player.config.colors.border};min-width:100%;min-height:4rem;box-sizing:border-box;white-space:pre}.${ns}-settings .${ns}-sub-settings .${ns}-col{min-height:1.55rem;display:flex;align-items:center;align-content:center;white-space:nowrap}.${ns}-settings .${ns}-settings-tabs{align-items:center;align-content:center;justify-content:center}.${ns}-settings .${ns}-settings-tab{margin:.25rem;text-decoration:underline;text-align:center}.${ns}-settings .${ns}-settings-tab.active{font-weight:bold}.${ns}-settings .${ns}-settings-group{display:none}.${ns}-settings .${ns}-settings-group.active{display:block}.${ns}-settings .${ns}-host-input{margin:.5rem 0;border-top:solid 1px ${Player.config.colors.border}}.${ns}-settings .${ns}-host-input.invalid{border:solid 1px red}.${ns}-settings .${ns}-host-input .${ns}-host-controls{align-items:center;justify-content:space-between;margin:.125rem 0}.${ns}-settings .${ns}-host-input input[type=text]{min-width:100%;box-sizing:border-box}.${ns}-threads .${ns}-thread-board-list label{display:inline-block;width:4rem}.${ns}-threads .${ns}-thread-list{margin:1rem -0.25rem 0;padding:.5rem 1rem;border-top:solid 1px ${Player.config.colors.border}}.${ns}-threads .${ns}-thread-list .boardBanner{margin:1rem 0}.${ns}-threads table{margin-top:.5rem;border-collapse:collapse}.${ns}-threads table th{border-bottom:solid 1px ${Player.config.colors.border}}.${ns}-threads table th,.${ns}-threads table td{text-align:left;padding:.25rem}.${ns}-threads table tr{padding:.25rem 0}.${ns}-threads table .${ns}-threads-body tr{background:${Player.config.colors.even_row}}.${ns}-threads table .${ns}-threads-body tr:nth-child(2n){background:${Player.config.colors.odd_row}}.${ns}-create-sound-status{margin-top:.5rem;border:solid 1px ${Player.config.colors.border};border-radius:5px;padding:.25rem}.${ns}-file-overlay,.${ns}-create-sound-form input[type=text]{height:1.5rem;box-sizing:border-box;width:100%;min-width:5rem;color:#000}.${ns}-file-overlay.placeholder span,.${ns}-create-sound-form input[type=text]::placeholder{color:#aaa;opacity:1}.${ns}-file-overlay{position:relative;background:#fff;border:solid 1px ${Player.config.colors.border};padding:0 .25rem;display:flex;align-items:center}.${ns}-file-overlay .placeholder-text{display:none}.${ns}-file-overlay.placeholder .placeholder-text{display:inherit}.${ns}-file-overlay>span{white-space:nowrap;overflow:hidden}.${ns}-file-overlay>input[type=file]{width:100%;box-sizing:border-box;height:100%;position:absolute;left:0;opacity:0}.${ns}-file-overlay .overfile{z-index:9999}.${ns}-input-append{position:absolute;display:flex;align-items:center;background:#fff;padding-left:.25rem;right:.125rem}.${ns}-threads,.${ns}-settings,.${ns}-tools,.${ns}-player{display:none}#${ns}-container[data-view-style=settings] .${ns}-settings{display:block}#${ns}-container[data-view-style=threads] .${ns}-threads{display:block}#${ns}-container[data-view-style=tools] .${ns}-tools{display:block}#${ns}-container[data-view-style=image] .${ns}-player,#${ns}-container[data-view-style=playlist] .${ns}-player,#${ns}-container[data-view-style=fullscreen] .${ns}-player{display:block}#${ns}-container[data-view-style=image] .${ns}-list-container,#${ns}-container[data-view-style=image] .${ns}-playlist-search{display:none}#${ns}-container[data-view-style=image] .${ns}-image-link{height:auto}#${ns}-container[data-view-style=playlist] .${ns}-image-link{height:125px !important}#${ns}-container[data-view-style=fullscreen] .${ns}-image-link{height:calc(100% - .4rem) !important}#${ns}-container[data-view-style=fullscreen] .${ns}-controls{position:absolute;left:0;right:0;bottom:calc(-2.5rem + .4rem)}#${ns}-container[data-view-style=fullscreen] .${ns}-controls:hover{bottom:0}`},function(e,t){e.exports=(e={})=>Player.userTemplate.build({template:Player.config.footerTemplate,sound:Player.playing})+`<div class="${ns}-expander"></div>`},function(e,t){e.exports=(e={})=>Player.userTemplate.build({template:Player.config.headerTemplate,sound:Player.playing,defaultName:"4chan Sounds",outerClass:ns+"-col-auto"})},function(e,t){e.exports=(e={})=>{const t=Player.config.uploadHosts[e];return t?`<div class="${ns}-host-input ${t.invalid?"invalid":""}" data-host-name="${e}">\n\t\t<div class="${ns}-row ${ns}-host-controls">\n\t\t\t<div class="${ns}-col-auto">\n\t\t\t\t<label>\n\t\t\t\t\t<input type="checkbox" data-property="defaultUploadHost" ${Player.config.defaultUploadHost===e?"checked":""}>\n\t\t\t\t\tDefault\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t<div class="${ns}-col-auto"><a href="#" class="${ns}-heading-action ${ns}-remove-host" data-handler="settings.removeHost" data-property="uploadHosts">Remove</a></div>\n\t\t</div>\n\t\t<div class="${ns}-row">\n\t\t\t<div class="${ns}-col"><input type="text" data-property="uploadHosts" name="name" value="${e||""}" placeholder="Name"></div>\n\t\t\t<div class="${ns}-col"><input type="text" data-property="uploadHosts" name="url" value="${t.url||""}" placeholder="URL"></div>\n\t\t\t<div class="${ns}-col"><input type="text" data-property="uploadHosts" name="responsePath" value="${t.responsePath||""}" placeholder="Response Path"></div>\n\t\t\t<div class="${ns}-col"><input type="text" data-property="uploadHosts" name="responseMatch" value="${t.responseMatch||""}" placeholder="Response Match"></div>\n\t\t\t<div class="${ns}-col"><input type="text" data-property="uploadHosts" name="soundUrl" value="${t.soundUrl||""}" placeholder="File URL Format"></div>\n\t\t</div>\n\t\t<div class="${ns}-row">\n\t\t\t<div class="${ns}-col"><textarea data-property="uploadHosts" name="data" placeholder="Data (JSON)">${JSON.stringify(t.data,null,4)}</textarea></div>\n\t\t</div>\n\t\t<div class="${ns}-row">\n\t\t\t<div class="${ns}-col"><textarea data-property="uploadHosts" name="headers" placeholder="Headers (JSON)">${t.headers?JSON.stringify(t.headers,null,4):""}</textarea></div>\n\t\t</div>\n\t</div>`:""}},function(e,t){e.exports=(e={})=>`<div class="${ns}-menu dialog" id="menu" tabindex="0" data-type="post" style="position: fixed;">\n\t<a class="${ns}-remove-link entry focused" href="javascript:;" data-id="${e.sound.id}">Remove</a>\n\t${e.sound.post?`<a class="entry" href="#${(is4chan?"p":"")+e.sound.post}">Show Post</a>`:""}\n\t<div class="entry has-submenu">\n\t\tOpen\n\t\t<div class="dialog submenu" style="inset: 0px auto auto 100%;">\n\t\t\t<a class="entry" href="${e.sound.image}" target="_blank">Image</a>\n\t\t\t<a class="entry" href="${e.sound.src}" target="_blank">Sound</a>\n\t\t</div>\n\t</div>\n\t<div class="entry has-submenu">\n\t\tDownload\n\t\t<div class="dialog submenu" style="inset: 0px auto auto 100%;">\n\t\t\t<a class="${ns}-download-link entry" href="javascript:;" data-src="${e.sound.image}" data-name="${e.sound.filename}">Image</a>\n\t\t\t<a class="${ns}-download-link entry" href="javascript:;" data-src="${e.sound.src}">Sound</a>\n\t\t</div>\n\t</div>\n\t<div class="entry has-submenu">\n\t\tFilter\n\t\t<div class="dialog submenu" style="inset: 0px auto auto 100%;">\n\t\t\t${e.sound.imageMD5?`<a class="${ns}-filter-link entry" href="javascript:;" data-filter="${e.sound.imageMD5}">Image</a>`:""}\n\t\t\t<a class="${ns}-filter-link entry" href="javascript:;" data-filter="${e.sound.src.replace(/^(https?\:)?\/\//,"")}">Sound</a>\n\t\t</div>\n\t</div>\n</div>`},function(e,t){e.exports=(e={})=>(e.sounds||Player.sounds).map(e=>`<div class="${ns}-list-item ${ns}-row ${e.playing?"playing":""}" data-id="${e.id}" ${Player.playlist.matchesSearch(e)?"":'style="display: none"'} draggable="true">\n\t\t${Player.userTemplate.build({template:Player.config.rowTemplate,sound:e,outerClass:ns+"-col-auto"})}\n\t</div>`).join("")},function(e,t){e.exports=(e={})=>`<div class="${ns}-media">\n\t<a class="${ns}-image-link" target="_blank">\n\t\t<img class="${ns}-image"></img>\n\t\t<video class="${ns}-video"></video>\n\t</a>\n\t<div class="${ns}-controls ${ns}-row">\n\t\t${Player.templates.controls(e)}\n\t</div>\n</div>\n<input class="${ns}-playlist-search" type="input" placeholder="Search" style="min-width: 100%; box-sizing: border-box; ${Player.config.showPlaylistSearch?"":"display: none;"}">\n<div class="${ns}-list-container style="height: 100px">\n\t${Player.templates.list(e)}\n</div>\n<img class="${ns}-hover-image">`},function(e,t,n){e.exports=(e={})=>{const t=n(0).reduce((e,t)=>(t.displayGroup&&(e[t.displayGroup]||(e[t.displayGroup]=[]),e[t.displayGroup].push(t)),e),{});let a=`<div class="${ns}-settings-tabs ${ns}-row">\n\t\t${Object.keys(t).map(e=>`<a href="javascript:;" class="${ns}-col-auto ${ns}-settings-tab ${Player.settings.view!==e?"":"active"}" data-group="${e}">${e}</a>`).join(" | ")}\n\t\t| <a href="https://github.com/rcc11/4chan-sounds-player/releases" class="${ns}-col-auto ${ns}-settings-tab" target="_blank">v3.0.0-32b5b39</a>\n\t</div>`;return Object.keys(t).forEach(e=>{a+=`<div class="${ns}-settings-group ${Player.settings.view!==e?"":"active"}" data-group="${e}">`,t[e].forEach((function e(t){if(null===t.displayMethod)return;const n=t.description;if(a+=`\n\t\t\t<div class="${ns}-row ${t.isSubSetting?ns+"-sub-settings":""}">\n\t\t\t\t<div class="${ns}-col ${t.isSubSetting?"":ns+"-heading"} ${n?ns+"-has-description":""}" ${n?`title="${n.replace(/"/g,"&quot;")}"`:""}>\n\t\t\t\t\t${t.title}\n\t\t\t\t\t${(t.actions||[]).map(e=>`<a href="#" class="${ns}-heading-action" data-handler="${e.handler}" data-property="${t.property}">${e.title}</a>`).join(" ")}\n\t\t\t\t</div>`,t.text&&(a+=t.dismissTextId?`<div class="${ns}-col" style="min-width: 100%">`+Player.display.ifNotDismissed(t.dismissTextId,t.dismissRestoreText,`<div data-dismiss-id="${t.dismissTextId}">`+t.text+`<a href="javascript:;" class="${ns}-dismiss-link" data-dismiss="${t.dismissTextId}" style="display:block; margin-top:.25rem">Dismiss</a></div>`)+"</div>":t.text),t.settings)t.settings.forEach(n=>e({...t,actions:null,settings:null,description:null,...n,isSubSetting:!0}));else{let e=_get(Player.config,t.property,t.default),n=(t.attrs||"")+(t.class?` class="${t.class}"`:"")+` data-property="${t.property}"`;t.format&&(e=_get(Player,t.format)(e));let s=t.displayMethod,r=_get(Player,s),o=typeof e;t.split?e=e.join(t.split):"object"===o&&(e=JSON.stringify(e,null,4)),a+=`\n\t\t\t\t\t<div class="${ns}-col">\n\t\t\t\t\t\t${"function"==typeof r?r(e,n):"boolean"===o?`<input type="checkbox" ${n} ${e?"checked":""}></input>`:"textarea"===s||"object"===o?`<textarea ${n}>${e}</textarea>`:t.options?`<select ${n}>\n\t\t\t\t\t\t\t\t${Object.keys(t.options).map(n=>`<option value="${n}" ${e===n?"selected":""}>\n\t\t\t\t\t\t\t\t\t${t.options[n]}\n\t\t\t\t\t\t\t\t</option>`).join("")}\n\t\t\t\t\t\t\t</select>`:`<input type="text" ${n} value="${e}"></input>`}\n\t\t\t\t\t</div>`}a+="</div>"})),a+="</div>"}),a}},function(e,t){e.exports=(e={})=>`<div class="${ns}-heading ${ns}-has-description" title="Search for threads with a sound OP">\n\tActive Threads\n\t${Player.threads.loading?"":`- <a class="${ns}-fetch-threads-link ${ns}-heading-action" href="#">Update</a>`}\n</div>\n<div style="display: ${Player.threads.loading?"block":"none"}">Loading</div>\n<div style="display: ${Player.threads.loading?"none":"block"}">\n\t<div class="${ns}-heading ${ns}-has-description" title="Only includes threads containing the search.">\n\t\tFilter\n\t</div>\n\t<input type="text" class="${ns}-threads-filter" value="${Player.threads.filterValue||""}"></input>\n\t<div class="${ns}-heading">\n\t\tBoards - <a class="${ns}-all-boards-link ${ns}-heading-action" href="#">${Player.threads.showAllBoards?"Selected Only":"Show All"}</a>\n\t</div>\n\t<div class="${ns}-thread-board-list">\n\t\t${Player.templates.threadBoards(e)}\n\t</div>\n\t${Player.threads.hasParser&&"table"!==Player.config.threadsViewStyle?`<div class="${ns}-thread-list"></div>`:`<table style="width: 100%">\n\t\t\t\t<tr>\n\t\t\t\t\t<th>Thread</th>\n\t\t\t\t\t<th>Subject</th>\n\t\t\t\t\t<th>Replies/Images</th>\n\t\t\t\t\t<th>Started</th>\n\t\t\t\t\t<th>Updated</th>\n\t\t\t\t<tr>\n\t\t\t\t<tbody class="${ns}-threads-body"></tbody>\n\t\t\t</table>`}\n</div>`},function(e,t){e.exports=(e={})=>(Player.threads.boardList||[]).map(e=>{let t=Player.threads.selectedBoards.includes(e.board);return t||Player.threads.showAllBoards?`<label>\n\t\t\t<input type="checkbox" value="${e.board}" ${t?"checked":""}>\n\t\t\t/${e.board}/\n\t\t</label>`:""}).join("")},function(e,t){e.exports=(e={})=>Object.keys(Player.threads.displayThreads).reduce((e,t)=>e.concat(Player.threads.displayThreads[t].map(e=>`\n\t\t<tr>\n\t\t\t<td>\n\t\t\t\t<a class="quotelink" href="//boards.${e.ws_board?"4channel":"4chan"}.org/${e.board}/thread/${e.no}#p${e.no}" target="_blank">\n\t\t\t\t\t>>>/${e.board}/${e.no}\n\t\t\t\t</a>\n\t\t\t</td>\n\t\t\t<td>${e.sub||""}</td>\n\t\t\t<td>${e.replies} / ${e.images}</td>\n\t\t\t<td>${timeAgo(e.time)}</td>\n\t\t\t<td>${timeAgo(e.last_modified)}</td>\n\t\t</tr>\n\t`)),[]).join("")},function(e,t){e.exports=(e={})=>`<div class="${ns}-heading">Encode / Decode URL</div>\n<div class="${ns}-row">\n\t<input type="text" class="${ns}-decoded-input ${ns}-col" placeholder="https://">\n\t<input type="text" class="${ns}-encoded-input ${ns}-col" placeholder="https%3A%2F%2F">\n</div>\n\n<div class="${ns}-heading">\n\tCreate Sound Image\n</div>\n<div class="${ns}-create-sound-form">\n\t<div class="${ns}-row" style="margin-bottom: .5rem">\n\t\t${Player.display.ifNotDismissed("createSoundDetails","Show Help",`<div class="${ns}-col" data-dismiss-id="createSoundDetails">\n\t\t\tSelect an image and sound to combine as a sound image.\n\t\t\tThe sound will be uploaded to the selected file host and the url will be added to the image filename.\n\t\t\t${Player.tools.hasFFmpeg?"Selecting a webm with audio as the image will split it into a video only webm to be posted and ogg audio file to be uploaded.":"For a webm with audio first split the webm into a separate video and audio file and select them both."}\n\t\t\t<a href="javascript:;" class="${ns}-dismiss-link" data-dismiss="createSoundDetails">Dismiss</a>\n\t\t</div>`)}\n\t</div>\n\t<div class="${ns}-row">\n\t\tHost\n\t</div>\n\t<div class="${ns}-row">\n\t\t<div class="${ns}-col">\n\t\t\t<select class="${ns}-create-sound-host">\n\t\t\t\t${Object.keys(Player.config.uploadHosts).map((e,t)=>Player.config.uploadHosts[e]&&!Player.config.uploadHosts[e].invalid?`<option value="${e}" ${Player.config.defaultUploadHost===e?"selected":""}>${e}</option>`:"").join("")}\n\t\t\t</select>\n\t\t</div>\n\t</div>\n\t<div class="${ns}-row">\n\t\tData\n\t</div>\n\t<div class="${ns}-row">\n\t\t<div class="${ns}-col">\n\t\t\t<div class="${ns}-file-overlay placeholder">\n\t\t\t\t<span class="placeholder">Select/Drop Image</span>\n\t\t\t\t<span class="text"></span>\n\t\t\t\t<input class="${ns}-create-sound-img" type="file" accept="image/*,.webm">\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="${ns}-col">\n\t\t\t<div class="${ns}-file-overlay placeholder" ${Player.tools.useSoundURL?"display: none;":""}>\n\t\t\t\t<span class="placeholder">Select/Drop Sound</span>\n\t\t\t\t<span class="text"></span>\n\t\t\t\t<div class="overfile ${ns}-input-append">\n\t\t\t\t\t${!Player.tools.hasFFmpeg&&`<label class="${ns}-use-video-label" style="display: none;">Copy video<input type="checkbox" class="${ns}-use-video"></label>`||""}\n\t\t\t\t\t<a href="#" class="${ns}-toggle-sound-input fa fa-link" data-type="url" title="Enter a URL of a previously uploaded file.">U</a>\n\t\t\t\t</div>\n\t\t\t\t<input class="${ns}-create-sound-snd" type="file" accept="audio/*,video/*">\n\t\t\t</div>\n\t\t\t<div class="${ns}-row" style="align-items: center; position: relative; ${Player.tools.useSoundURL?"":"display: none;"}">\n\t\t\t\t<a href="#" class="${ns}-toggle-sound-input ${ns}-input-append" data-type="file" title="Select a file to upload.">\n\t\t\t\t\t<span class="fa fa-file-sound-o" style="margin-right: .125rem">F</span>\n\t\t\t\t</a>\n\t\t\t\t<input type="text" class="${ns}-create-sound-snd-url" placeholder="Sound URL" style="min-width: 100%;">\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="${ns}-row">\n\t\t<div class="${ns}-col">\n\t\t\t<input type="text" class="${ns}-create-sound-name" placeholder="Name">\n\t\t</div>\n\t</div>\n\t<div class="${ns}-row" style="margin-top: .5rem">\n\t\t<div class="${ns}-col-auto" style="margin-right: .5rem">\n\t\t\t<button class="${ns}-create-button">Create</button>\n\t\t</div>\n\t</div>\n</div>\n<div class="${ns}-create-sound-status" ${Player.tools.createStatusText?"":'style="display: none"'}>\n\t${Player.tools.createStatusText}\n</div>`},function(e,t){e.exports=(e={})=>`<div class="${ns}-menu dialog" id="menu" tabindex="0" data-type="post" style="position: fixed;">\n\t${["playlist","image"].includes(Player.config.viewStyle)?"":`<a class="${ns}-player-button entry" href="javascript:;">Player</a>`}\n\t${"settings"===Player.config.viewStyle?"":`<a class="${ns}-config-button entry" href="javascript:;">Settings</a>`}\n\t${"threads"===Player.config.viewStyle?"":`<a class="${ns}-threads-button entry" href="javascript:;">Threads</a>`}\n\t${"tools"===Player.config.viewStyle?"":`<a class="${ns}-tools-button entry" href="javascript:;">Tools</a>`}\n</div>`}]);